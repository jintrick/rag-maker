# RAGMaker Architecture

## 1. 概要
本文書は、RAG (Retrieval-Augmented Generation) を用いた対話型アプリケーション「RAGMaker」のアーキテクチャを定義する。
このシステムは、「**外部ソースから情報を自動収集し、各ドキュメントの要約を記載したカタログを作成する機能**」を中核に据える。

## 2. 操作コマンド
ユーザーはGemini CLIを介して、以下の2つの主要コマンドでシステムを操作する。

*   `/rag <ソースパス>`: **中核機能。** ローカルのドキュメント群をスキャンし、各ドキュメントの概要を記述した`discovery.json`を生成・更新する。
*   `/ask <質問文>`: **対話機能。** `discovery.json`を読み、質問に最も関連性の高いドキュメントをLLMが選択。そのドキュメントの内容を基に回答を生成する。

## 3. アーキテクチャ詳細

### 3.1. RAGデータベースの発見と管理
本システムは、複数のドキュメント情報を一元的に管理するため、プロジェクトルートに`discovery.json`ファイルを配置する。

*   **目的:** プロジェクト内に存在するドキュメントの場所、タイトル、概要をカタログ化し、`/ask`コマンドが最適なドキュメントを動的に選択できるようにする。
*   **構造:** スキーマ、タイトル、そして各ドキュメントのパス、タイトル、要約を含む`documents`配列などで構成される。
*   **更新:** `/rag`コマンド実行時に自動で生成・更新される。

### 3.2. 中核機能: `/rag` コマンドフロー
このコマンドは、AIエージェント自身の読解・要約能力と、いくつかの支援ツールを組み合わせることで、指定されたソースからドキュメントカタログ (`discovery.json`) を構築する。

1.  ユーザーが情報ソースのパス (`{{args}}`) を指定し、コマンドを実行する。
2.  AIエージェントはソースパスの種別（ローカルディレクトリ、WebページURL、GitHubリポジトリURL）を判断する。
3.  ソース種別に応じて、AIエージェントは以下のツールを自律的に呼び出し、ドキュメントのテキスト内容を取得する。
    *   **ローカルディレクトリの場合:** `read_many_files` ツールを使い、ディレクトリ内の全ドキュメントを読み込む。
    *   **Webページの場合:** `web_fetch` ツール（新規作成）を使い、指定URLの本文を収集する。取得したHTMLは `html_to_markdown` ツール（新規作成）で整形する。
    *   **GitHubリポジトリの場合:** `github_fetch` ツール（新規作成）を使い、リポジトリ内のドキュメントファイルを収集する。
4.  AIエージェントは、取得した各ドキュメントの内容を読み解き、それぞれについて `title` と `summary` を生成する。（**AIエージェント自身の能力**）
5.  AIエージェントは、全ドキュメントの情報を集約し、`discovery.json` ファイルの内容を生成する。
6.  `write_file` ツールを使い、生成した内容を `discovery.json` としてプロジェクトルートに保存する。
7.  カタログの構築と登録が完了したことをユーザーに通知する。

### 3.3. 対話機能: `/ask` コマンドフロー
このコマンドは、AIエージェントの推論能力を活用し、ユーザーの質問に対して最適な回答を生成する。

`/ask`コマンドが実行されると、システムはプロジェクトルートの`discovery.json`カタログとユーザーの質問を基に、AIエージェントに対して回答生成を指示する。AIエージェントはカタログ情報を参照して最も関連性の高いドキュメントを特定し、その内容を読み解いた上で、最終的な回答を生成する。この一連の判断と実行は、AIエージェントが自律的に行う。

## 4. 使用技術と採用理由

*   **言語: Python**
    *   **理由:** 機械学習やテキスト処理のライブラリが豊富で、RAGシステムの開発に最も適しているため。
*   **HTTPクライアント: `requests`, `BeautifulSoup`**
    *   **理由:** Webページからの情報収集（クローリング）を安定して行うための、実績のある標準的な組み合わせであるため。
*   **Gitクライアント: `GitPython`**
    *   **理由:** GitHubからdocsのような特定のフォルダのみをクローンするため。
*   **UI: Gemini CLI**
    *   **理由:** ユーザーとの対話インターフェースを提供し、GUI不要、自然言語を理解して各種ツールを実行できるため。