# RAGMaker Architecture

## 1. 概要
本文書は、RAG (Retrieval-Augmented Generation) を用いた対話型アプリケーション「RAGMaker」のバックエンドアーキテクチャを定義する。
このシステムは、「外部ソースから情報を自動収集し、RAGデータベースを構築する機能」を中核に据える。

## 2. 操作コマンド
ユーザーはGemini CLIを介して、以下の2つの主要コマンドでシステムを操作する。

*   `/rag <ソースURL>`: **中核機能。** WebサイトやGitHubリポジトリから情報を収集し、RAGデータベースを構築する。
*   `/ask`: **対話インターフェースの起動ボタン。** `/rag`で構築したデータベースと対話するモードを開始する。

## 3. アーキテクチャ詳細

### 3.1. 中核機能: `/rag` コマンドフロー
このコマンドは、指定されたURLを基に、RAGデータベースの構築をゼロから自動で行う。

1.  ユーザーが情報ソースのURL（Webページ or GitHubリポジトリ）を指定し、コマンドを実行する。
2.  バックエンドのPythonスクリプト（データ投入サービス）が起動する。
3.  URLの種別を判定する。
    *   **Webページの場合:**
        1.  指定されたURLのHTMLをHTTPで取得する。
        2.  本文を抽出し、ページ内のリンクを収集する。
        3.  指定されたルール（例: 同一ドメイン内のみ）に基づき、リンク先を再帰的に探索・収集する。
    *   **GitHubリポジトリの場合:**
        1.  `git clone`でリポジトリをローカルにダウンロードする。
        2.  リポジトリ内から`docs/`などのドキュメント群を探索し、テキストファイルを抽出する。
4.  収集した全テキストデータを、以下の手順で処理する。
    a. 適切なサイズにチャンク分割する。
    b. 埋め込みモデルで各チャンクをベクトル化する。
    c. ベクトルと元テキストを**Vector DB**に保存・インデックス化する。
5.  構築が完了したことをユーザーに通知する。

### 3.2. 対話機能: `/ask` コマンドフロー
このコマンドは、構築済みのデータベースと対話するための専用モードを開始する「スタートボタン」として機能する。

1.  ユーザーが `/ask` コマンドを実行する。
2.  システムが「対話モード」に切り替わる。プロンプトが `(RAG) >` のように変化し、ユーザーからの質問を待ち受ける状態になる。
3.  ユーザーが質問文を入力してEnterを押す。
4.  バックエンドのRAG APIが質問文を受け取り、以下の処理を行う。
    a. 質問文をベクトル化する。
    b. Vector DBに問い合わせ、類似度の高いテキストチャンクを取得する。
    c. 取得したチャンクと質問文を基に、LLMに回答を生成させる。
5.  LLMの回答がCLIに表示され、ユーザーは再び次の質問を入力できる。
6.  ユーザーが `/exit` などの終了コマンドを入力するまで、対話モードは継続する。

## 4. 使用技術と採用理由

*   **言語: Python**
    *   **理由:** 機械学習やテキスト処理のライブラリが豊富で、RAGシステムの開発に最も適しているため。
*   **HTTPクライアント: `requests`, `BeautifulSoup`**
    *   **理由:** Webページからの情報収集（クローリング）を安定して行うための、実績のある標準的な組み合わせであるため。
*   **Gitクライアント: `GitPython`**
    *   **理由:** `git clone`等の操作をPythonから実行するため。特に、巨大なリポジトリから`docs`ディレクトリのみをダウンロードする**「スパースチェックアウト」**をプログラム的に制御し、データ収集を効率化するために採用する。
*   **Vector DB: `ChromaDB`**
    *   **理由:** セットアップが容易なファイルベースのVector DBであり、迅速なプロトタイピングに適しているため。
*   **テキスト処理・LLM連携: `LangChain`**
    *   **理由:** チャンク分割、ベクトル化、LLMとの対話といった、RAGパイプラインの複雑な処理を抽象化し、開発を効率化するフレームワークであるため。
*   **UI: Gemini CLI**
    *   **理由:** ユーザーとの対話インターフェースとして指定されているため。
