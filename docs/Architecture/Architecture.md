# RAGMaker Architecture

## 1. 概要
本文書は、RAG (Retrieval-Augmented Generation) を用いた対話型アプリケーション「RAGMaker」のアーキテクチャを定義する。
このシステムは、「**外部ソースから情報を自動収集し、各ドキュメントの要約を記載したカタログを作成する機能**」を中核に据える。

## 2. 操作コマンド
ユーザーはGemini CLIを介して、以下の2つの主要コマンドでシステムを操作する。

*   `/rag <ソースパス>`: **中核機能。** ローカルのドキュメント群をスキャンし、各ドキュメントの概要を記述した`discovery.json`を生成・更新する。
*   `/ask <質問文>`: **対話機能。** `discovery.json`を読み、質問に最も関連性の高いドキュメントをLLMが選択。そのドキュメントの内容を基に回答を生成する。

## 3. アーキテクチャ詳細

### 3.1. RAGデータベースの発見と管理
本システムは、複数のドキュメント情報を一元的に管理するため、プロジェクトルートに`discovery.json`ファイルを配置する。

*   **目的:** プロジェクト内に存在するドキュメントの場所、タイトル、概要をカタログ化し、`/ask`コマンドが最適なドキュメントを動的に選択できるようにする。
*   **構造:** スキーマ、タイトル、そして各ドキュメントのパス、タイトル、要約を含む`documents`配列などで構成される。
*   **更新:** `/rag`コマンド実行時に自動で生成・更新される。

### 3.2. 中核機能: `/rag` コマンドフロー
このコマンドは、指定されたパスを基に、ドキュメントのカタログ (`discovery.json`) を構築する。

1.  ユーザーが情報ソースのパスを指定し、コマンドを実行する。
2.  LLMは**自らの推論能力を用いて**ソースの種別を判定する（ローカルディレクトリ、WebページURL、GitHubリポジトリURLなど）。
3.  **`generate_document_catalog`ツール**（新規作成）を使って、ソース内の全ドキュメント（`.md`ファイルなど）をスキャンする。
4.  ツールは各ドキュメントの内容を基に、LLMに`title`と`summary`の生成を依頼する。
5.  ツールは全ドキュメントの情報を集約し、`discovery.json`ファイルとしてプロジェクトルートに保存する。
6.  カタログの構築と登録が完了したことをユーザーに通知する。

### 3.3. 対話機能: `/ask` コマンドフロー
このコマンドは、ユーザーの質問に最も関連性の高いドキュメントをカタログから選択し、その内容を基に回答を生成する。

1.  ユーザーが `/ask <質問文>` コマンドを実行する。
2.  システムは、まず`discovery.json`を読み込む。
3.  `documents`配列に含まれる全ドキュメントの`title`と`summary`をリストアップする。
4.  リストとユーザーの質問文をLLMに提示し、「どのドキュメント（`path`）が質問に回答するのに最も適切か」を一つ選択させる。（**LLM呼び出し1回目**）
5.  システムは選択された`path`のファイルを `read_file` ツールで読み込む。
6.  読み込んだファイルの内容と元の質問文を基に、LLMに最終的な回答を生成させる。（**LLM呼び出し2回目**）
7.  生成された回答がCLIに表示される。

## 4. 使用技術と採用理由

*   **言語: Python**
    *   **理由:** 機械学習やテキスト処理のライブラリが豊富で、RAGシステムの開発に最も適しているため。
*   **HTTPクライアント: `requests`, `BeautifulSoup`**
    *   **理由:** Webページからの情報収集（クローリング）を安定して行うための、実績のある標準的な組み合わせであるため。
*   **Gitクライアント: `GitPython`**
    *   **理由:** `git clone`等の操作をPythonから実行するため。
*   **テキスト処理・LLM連携: `LangChain`**
    *   **理由:** LLMとの対話やプロンプト管理といった処理を抽象化し、開発を効率化するフレームワークであるため。
*   **UI: Gemini CLI**
    *   **理由:** ユーザーとの対話インターフェースとして指定されているため。