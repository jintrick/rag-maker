# Issue v0.6.1.11: 【強制執行】ツール出力の純粋化と全ツールの構造的統一

## 前提知識
- docs/issue/v0.6.1.10.md (失敗の記録)
- src/ragmaker/tools/*.py (全13ツール)

## 経緯
Julesは過去のIssueにおいて、Pythonのモジュールロード順序を無視した不完全なログ抑制を行い、かつ禁止された「コード重複（フォールバックの再実装）」を繰り返した。これはエンジニアリングに対する冒涜である。本Issueでは、全13ツールのソースコード構造を完全に統一し、出力の純粋性を物理的に担保する。

## 現状の問題点
- **手遅れなログ抑制**: `main()` 内で `logging.disable` しても、その前の `ImportError` ブロックでの出力汚染は防げない。
- **無駄なコピペ**: `entry_discovery.py` 等に `eprint_error` などの関数が再定義されており、コードベースが肥大化・汚染されている。
- **不徹底な多言語排除**: `init_cache.py` 等の深い階層に依然として日本語が残存している。

## ゴール（完了の定義）
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] **全13ツール**（後述のリスト参照）のファイル先頭が、指定された【標準ヘッダー】に書き換えられている。
- [ ] 各ツールの `ImportError` ブロックが、指定された【標準フォールバック】に統一され、**関数の再定義が一切含まれていない。**
- [ ] `src/ragmaker/tools/entry_discovery.py` が `test/test_package_dependency.py` のテスト対象に追加されている。
- [ ] `grep -r "[あ-んア-ン一-龠]" src` を実行し、日本語が1文字もヒットしない。
- [ ] `pytest test/test_package_dependency.py` がパスし、`stderr` が純粋な JSON であることが実証されている。

## 解決策の詳細（強制コード指定）

### 1. 【標準ヘッダー】の強制配置
**すべてのツール（src/ragmaker/tools/*.py）**の `#!/usr/bin/env python3` の直後に、必ず以下のコードを配置せよ。これより前に他の `import` を行うことは厳禁とする。

```python
import logging
import sys
import json
import argparse
import os
import shutil
from pathlib import Path
from typing import Any, Optional, List

# Suppress all logging output at the earliest possible stage to ensure pure JSON stderr on error.
logging.disable(logging.CRITICAL)
```

### 2. 【標準フォールバック】の強制適用
依存関係のインポートは以下の形式**のみ**を許可する。`eprint_error` などの関数をその場で定義することは「退行」と見なし、却下する。

```python
try:
    from ragmaker.io_utils import (
        ArgumentParsingError,
        GracefulArgumentParser,
        eprint_error,
        handle_argument_parsing_error,
        handle_unexpected_error,
        handle_io_error,
        print_json_stdout
    )
    from ragmaker.utils import safe_export, cleanup_dir_contents
except ImportError:
    # Use raw write to ensure no logging metadata is prepended.
    sys.stderr.write('{"status": "error", "message": "The \'ragmaker\' package is required. Please install it with: pip install ."}\n')
    sys.exit(1)
```

### 3. 不要なコードの削除
- 各ツールの `main()` 関数内にある `logging.disable` や `logging.basicConfig` をすべて削除せよ。
- 各ツールの `main()` 以外にある `setup_logging` 等の関数をすべて削除せよ。

## 対象ファイルリスト (全13ツール)
1. `ask_dir.py`
2. `cache_cleanup.py`
3. `create_knowledge_base.py`
4. `enrich_discovery.py`
5. `entry_discovery.py`
6. `file_sync.py`
7. `github_fetch.py`
8. `html_to_markdown.py`
9. `http_fetch.py`
10. `init_cache.py`
11. `install_kb.py`
12. `path_normalizer.py`
13. `read_file.py`
（※ `write_file.py` も含む。全ファイルを精査せよ）

## テスト方法
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `pytest test/test_package_dependency.py` を実行。全ツールの `subTest` がパスすることを確認した。
- [ ] `ImportError` 発生時の `result.stderr` を目視し、`{` で始まり `}` で終わる単一行の JSON であることを確認した。

## 実装状況
- [x] v0.6.1.11 起草
- [ ] 全13ツールのヘッダーおよびフォールバック統一完了
- [ ] 日本語コメントの物理的抹消完了
- [ ] テスト対象への entry_discovery.py 追加完了
- [ ] 最終パス確認完了