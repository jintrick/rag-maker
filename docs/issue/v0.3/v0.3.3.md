# Issue v0.3.3: 

## 前提知識
- docs/Architecture/Architecture.md
- .gemini/commands/rag.toml
- .gemini/commands/ask.toml

## 経緯
パスにスペースがあることによる `mkdir` の失敗:
* 問題: キャッシュディレクトリ C:\Synology Drive\2way-sync\work\rag-maker\cache\jules.google\
    を作成する際、パスにスペースが含まれており、適切に引用符で囲まれていなかったため、mkdir
    コマンドが失敗しました。cmd.exe は C:\Synology を別の引数として解釈しました。
* 対応: パス全体を二重引用符で囲むことで、この特定の mkdir の問題は解決しました。

## 現状の問題点
Gemini CLIのFlashモードは、度々パスにスペースが含まれていても、二重引用符で囲むのを忘れてしまう。
GEMINI.mdにはすでに記載がある。

## 解決策の概要
`make_cache_dir`ツールを作成する

## 解決策の詳細
`make_cache_dir`ツールはPythonスクリプトとして実装する。
このツールは、`cache/`ディレクトリ配下に作成するディレクトリの**相対パス**を引数として受け取る。例えば、`github_owner/repo_name`や`domain_name`、`正規化されたローカルパス`といった形式のパスを受け取り、`cache/<受け取ったパス>`としてディレクトリを作成する。
内部的には、Pythonの`os.makedirs`関数を`exist_ok=True`と共に使用してディレクトリを作成する。このアプローチは、`os.makedirs`がパスの引用符付けを内部的に処理し、クロスプラットフォームであるため堅牢であり、手動での引用符付けやディレクトリ作成のための`run_shell_command`の直接呼び出しの必要性を排除する。
- 作成した`make_cache_dir`ツールは、プロジェクトルートの`discovery.json`に登録する。
- `.gemini/commands/rag.md`を修正し、`make_cache_dir`ツールを使用するように変更する。（**注: この修正はjulesは行わない**）

## 参考とすべきスクリプト等
- `tools/utils.py` (特に `create_discovery_file` 関数内で `Path.mkdir(exist_ok=True)` の使用例、およびエラー処理とロギングの方法)

## テストスクリプトの作成
test/make_cache_dir/ ディレクトリに以下のケースに対応したテストスクリプトを作成する。
1.  **テストケース1: スペースを含む相対パス:** `make_cache_dir`ツールを、スペースを含む相対ディレクトリパス（例: `"test dir with spaces"`）で呼び出すテストケースを作成する。`cache/test dir with spaces`が正常に作成されることを確認する。
2.  **テストケース2: 既存の相対パス:** 既に存在する相対ディレクトリパス（例: `"existing_dir"`）に対して`make_cache_dir`を呼び出してもエラーが発生せず、`cache/existing_dir`がそのまま残ることを確認する。
3.  **テストケース3: ネストされた相対パス:** ネストされた相対ディレクトリパス（例: `"nested/test/dir"`）で`make_cache_dir`を呼び出し、`cache/nested/test/dir`が正常に作成されることを確認する。
4.  **テストケース4: 空のパス:** 空の文字列`""`を引数として`make_cache_dir`を呼び出した際の挙動を確認する。（エラーが発生するか、`cache/`が作成されるかなど）
5.  **テストケース5: 特殊文字を含むパス:** ファイルシステムで許可される特殊文字（例: `"!@#$%^&()"`）を含む相対パスで`make_cache_dir`を呼び出し、ディレクトリが正常に作成されることを確認する。