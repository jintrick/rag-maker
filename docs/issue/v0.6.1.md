# Issue v0.6.1: データ目録のリネーム（catalog.json）とインストールツールの実装

## 用語の定義
- **RAGMakerリポジトリルート**: 本プロジェクト（RAGMaker）のソースコードが置かれているルートディレクトリ。
- **マスターツールカタログ**: `RAGMakerリポジトリルート/discovery.json`。全ツールの定義ファイル。
- **ナレッジベース（KB）**: 構築されたRAGの実体（目録ファイルと `cache/` ディレクトリ）。
- **ドキュメントカタログ**: KB内にある個別のドキュメント目録ファイル。本issueで `catalog.json` に改称する。
- **インストール先ディレクトリ**: ユーザーがKBを配置したい任意のプロジェクト内のディレクトリ（例: `my-project/docs/rags/my-kb/`）。

## 前提知識
- docs/Architecture/Architecture.md
- discovery.json (RAGMakerリポジトリルートにあるマスターツールカタログ)
- .gemini/commands/rag.toml
- .gemini/commands/ask.toml

## 経緯
現在、RAGMakerリポジトリルートにある「マスターツールカタログ」と、各KB内にある「ドキュメントカタログ」の両方が `discovery.json` という同一のファイル名を使用している。これにより、AIエージェントが操作対象を誤認し、システム全体のツール定義を特定のKBのデータで上書き破壊する重大なリスクがある。このリスクを物理的に排除し、かつ構築したKBを他のプロジェクトへ容易に配置（インストール）できる仕組みを整える。

## 現状の問題点
- ツール定義（マスター）とドキュメント目録（データ）が同名であるため、AIや人間による誤操作を招きやすい。
- KBを別の場所へコピーした際、目録内のドキュメントパスが不整合を起こし、参照不能になる。
- 構築したKBをインストール先ディレクトリへ統合するための自動化された手段がない。

## ゴール（完了の定義）
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] 各KB内で生成される目録ファイルの名前が `catalog.json` に統一されている
- [ ] `install_kb` ツールが新規実装され、マスターツールカタログ（`discovery.json`）に登録されている
- [ ] 既存のKB（旧 `discovery.json` を含む）を `install_kb` で移行した際、インストール先ディレクトリで `catalog.json` として正しく機能する
- [ ] `.gemini/commands/` 配下の `rag.toml`, `ask.toml` が `catalog.json` を参照するように修正されている
- [ ] **RAGMakerリポジトリルートの `discovery.json`（マスターツールカタログ）が誤って上書き・破壊されていない**

## 解決策の概要
各KB内のドキュメントカタログを `discovery.json` から `catalog.json` へ全面的に改称し、関連ツールとコマンド定義を修正する。また、KBをインストール先ディレクトリにコピーし、目録の移行とパスの正規化を自動で行う `install_kb` ツールを実装する。

## 解決策の詳細

### 1. ドキュメントカタログの改称（`discovery.json` -> `catalog.json`）
以下のモジュールにおいて、データの保存・読み込み先として指定されているファイル名を `catalog.json` に変更する。
- `src/ragmaker/utils.py`: `print_discovery_data` 関数内のデフォルト保存先。
- `src/ragmaker/tools/entry_discovery.py`
- `src/ragmaker/tools/enrich_discovery.py`
- `src/ragmaker/tools/http_fetch.py`
- `src/ragmaker/tools/file_sync.py`
- `src/ragmaker/tools/init_cache.py`

### 2. コマンド定義の修正
RAGMakerが提供するコマンドの指示書（`.gemini/commands/` 内）において、目録の参照先を修正する。
- `rag.toml`: 登録先を `catalog.json` に変更。
- `ask.toml`: 参照元を `catalog.json` に変更。

### 3. `install_kb` ツールの実装（`src/ragmaker/tools/install_kb.py`）
KBをインストール先ディレクトリに配置し、パスを再構成する。
- **引数**:
    - `--source`: インストール元となるKBのルート。
    - `--target-kb-root`: インストール先となるディレクトリ。
    - `--force`: インストール先が存在する場合の上書き許可。
- **処理ロジック**:
    - `--source` から `cache/` ディレクトリをコピー。
    - `--source` 直下の目録ファイル（`discovery.json` または `catalog.json`）をコピーし、インストール先では必ず `catalog.json` という名前にする。
    - `catalog.json` 内の全ドキュメントの `path` フィールドを `pathlib.Path.as_posix()` で正規化し、実ファイルの存在を確認する。
    - **注意**: `.gemini/` ディレクトリはコピーしない。

### 4. マスターツールカタログの更新
- **RAGMakerリポジトリルートの `discovery.json`** に `install_kb` ツールの定義を追加する。

## 参考とすべきスクリプト等
- `src/ragmaker/utils.py`
- `src/ragmaker/tools/file_sync.py`

## テスト方法
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `pytest` を使用し、各ツールが `catalog.json` を出力することを検証するユニットテストを実行したか
- [ ] `ragmaker-install-kb --source <旧KB> --target-kb-root <新先>` を実行し、ファイル構成と `catalog.json` の内容が正しいことを確認したか
- [ ] `gemini /ask` コマンドが `catalog.json` を読み込んで正しく動作することを実演確認したか

## 実装状況
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] 実装完了