# Issue v0.4.2: `create_knowledge_base` ツールの改善とアーキテクチャの整合性向上

## 前提知識
- `docs/Architecture/Architecture.md`
- `tools/create_knowledge_base.py`
- `docs/issue/v0.4.0.md`

## 経緯
v0.4.0にて、ナレッジベースを自己完結した環境としてユーザー指定の場所に作成するため、`create_knowledge_base`ツールが導入されました。
現在の実装では、このツールはプロジェクトルートの`discovery.json`を雛形として新しいナレッジベースにコピーし、その後`documents`配列を空にする、という手順を踏んでいます。

## 現状の問題点
この「コピーして一部を削除する」アプローチには、いくつかの問題点があります。

1.  **ロジックの非効率性と不透明さ**:
    役割が異なる「プロジェクトルートのツールカタログ」を「ナレッジベースのカタログ」として単純にコピーし、後から一部を削除する処理は、直感的ではありません。これは「必要な要素を組み合わせて新規作成する」というアプローチに比べて無駄が多く、コードの意図が分かりにくくなっています。

2.  **メンテナンス性の低下**:
    将来、プロジェクトルートの`discovery.json`に、ナレッジベースには不要なプロジェクト固有の設定（例: デプロイ設定など）が追加された場合、現在のコピー方式ではそれらの不要な情報までナレッジベースに伝播してしまいます。

## 解決策の概要
`create_knowledge_base.py`を修正し、プロジェクトルートの`discovery.json`をコピーするのではなく、そこから必要な情報（ツール定義）のみを読み込み、ナレッジベース用の`discovery.json`をゼロから生成するように変更します。

## 解決策の詳細
`tools/create_knowledge_base.py` の `create_knowledge_base` 関数を以下のように修正します。

1.  **コピー処理の廃止**:
    `shutil.copy2` を使って `discovery.json` を丸ごとコピーする処理を削除します。

2.  **定義の読み込み**:
    プロジェクトルートの `discovery.json` を読み込み、`tools` 配列と `handles` オブジェクトの定義を抽出します。

3.  **新規ファイルの生成**:
    以下の要素を持つ新しいPython辞書を作成します。
    - `documents`: 空のリスト `[]`
    - `handles`: 読み込んだ `handles` オブジェクト
    - `tools`: 読み込んだ `tools` 配列

4.  **書き込み**:
    新しく作成した辞書を、ナレッジベースのルートディレクトリに `discovery.json` として書き出します。

この変更により、ロジックが明確になり、将来のメンテナンス性も向上します。

## 参考とすべきスクリプト等
*   `tools/create_knowledge_base.py` (修正対象)
*   `test/test_create_knowledge_base.py` (修正後の動作を検証するために更新が必要)

## テスト方法
`test/test_create_knowledge_base.py` を更新し、以下の点を確認します。

1.  ツール実行後、ナレッジベースのルートに `discovery.json` が正しく生成されること。
2.  生成された `discovery.json` が、プロジェクトルートの `discovery.json` から `tools` と `handles` の定義を引き継いでいること。
3.  生成された `discovery.json` の `documents` 配列が空であること。
4.  （推奨）テストの一環として、プロジェクトルートの `discovery.json` に一時的なトップレベルキー（例: `"project_specific_setting": "test"`）を追加し、それがナレッジベースの `discovery.json` にはコピーされないことを確認します。

## 実装状況