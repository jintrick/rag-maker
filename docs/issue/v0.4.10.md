# Issue v0.4.10: データ取得ツールのリファクタリングとロジック共通化

## 前提知識
- `docs/issue/v0.4.9.md`: ワークフローの抜本的見直しに関するIssue。
- `src/ragmaker/tools/http_fetch.py`
- `src/ragmaker/tools/github_fetch.py`
- `src/ragmaker/utils.py`

## 経緯
`v0.4.9`のアーキテクチャ変更により、`http_fetch`と`github_fetch`ツールは、取得したドキュメント一覧（`discovery.json`の内容）をファイルに書き込まず、標準出力にJSON形式で返す仕様になった。

## 現状の問題点
現在、`http_fetch.py`と`github_fetch.py`の両ツールにおいて、「`discovery.json`のデータ構造を構築し、標準出力に書き出す」というほぼ同一のロジックがそれぞれ個別に実装されている。

これはコードのDRY (Don't Repeat Yourself) 原則に反しており、将来`discovery.json`のフォーマットを変更する際に、複数のファイルを修正する必要が生じるため、メンテナンス性が低い状態にある。

## 解決策の概要
`http_fetch`と`github_fetch`で重複しているロジックを、`ragmaker/utils.py`に新しい共通関数として切り出す。
両ツールをリファクタリングし、この共通関数を呼び出すように修正することで、コードの重複を排除し、保守性を向上させる。

## 解決策の詳細
1.  **`ragmaker/utils.py` の修正**:
    -   `print_discovery_data(documents: list, metadata: dict)` という新しい共通関数を定義する。
    -   この関数は、引数で受け取った `documents` と `metadata` を基に、`discovery.json` のデータ構造（`{"documents": ..., "metadata": ...}`）を構築する。
    -   構築したデータを `ragmaker.io_utils.print_json_stdout` を使って標準出力に書き出す。
    -   `v0.4.9`の変更で不要になった古い `create_discovery_file` 関数を削除する。

2.  **`http_fetch.py` のリファクタリング**:
    -   `discovery_data` 辞書を自前で構築している部分を削除する。
    -   代わりに、`from ragmaker.utils import print_discovery_data` をインポートする。
    -   `fetcher.fetched_files_map` と、ツール固有のメタデータ辞書を引数として、`print_discovery_data` を呼び出すように修正する。

3.  **`github_fetch.py` のリファクタリング**:
    -   `http_fetch.py` と同様に、`print_discovery_data` を呼び出すように修正する。

## 参考とすべきスクリプト等
- `src/ragmaker/utils.py` (修正対象)
- `src/ragmaker/tools/http_fetch.py` (修正対象)
- `src/ragmaker/tools/github_fetch.py` (修正対象)
- `src/ragmaker/io_utils.py` (利用するユーティリティ)

## テスト方法
1.  **単体テストの修正**:
    -   `test/test_http_fetch.py` と `test/test_github_fetch.py` を修正または確認する。
    -   各ツールが、リファクタリング後も引き続き正しい構造のJSONを標準出力に書き出すことを確認する。
    -   可能であれば、`utils.print_discovery_data` が正しい引数で呼び出されているかをモックを使ってテストする。
2.  **統合テスト**:
    -   `/rag` コマンドを、Webソース (`http_fetch`) とGitHubソース (`github_fetch`) の両方で実行する。
    -   両方のケースでワークフローが最後まで正常に完了し、期待通りのナレッジベースが作成されることを確認する。

## 実装状況