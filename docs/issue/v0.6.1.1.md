# Issue v0.6.1.1: v0.6.1 実装の不備修正とテストの追加

## 前提知識
- docs/Architecture/Architecture.md
- docs/issue/v0.6.1.md
- discovery.json (RAGMakerリポジトリルートにあるマスターツールカタログ)

## 用語の定義
- **RAGMakerリポジトリルート**: 本プロジェクトのソースコードが置かれているルートディレクトリ。
- **マスターツールカタログ**: `RAGMakerリポジトリルート/discovery.json`。全ツールの定義ファイル。
- **ナレッジベース（KB）**: 構築されたRAGの実体。
- **ドキュメントカタログ**: KB内にあるドキュメント目録ファイル（catalog.json）。
- **インストール先ディレクトリ**: ユーザーがKBを配置したいターゲットプロジェクト内のパス。

## 経緯
Issue v0.6.1 において、ドキュメントカタログの `catalog.json` への改称と `install_kb` ツールの実装が行われたが、事後レビューにより、テストコードの欠落や、ソースコード内の docstring・ログメッセージにおける旧名称（discovery.json）の残存、および内部関数名の不一致が確認された。これらを修正し、実装を完全なものにする。

## 現状の問題点
- `test/test_install_kb.py` が存在せず、新規ツールの動作が検証されていない。
- `src/ragmaker/tools/github_fetch.py` が紛失しており、`pyproject.toml` の `ragmaker-github-fetch` 定義と不整合を起こしている（実行時に ImportError の原因となる）。
- `src/ragmaker/tools/` 配下の複数のツールにおいて、docstring や `Usage` 内の記述が `discovery.json` のままになっている。
- 各ツールのログ出力メッセージ（`Successfully updated discovery file` 等）に `discovery` という単語が残っており、`catalog.json` への改称と矛盾している。
- `src/ragmaker/data/ask.toml` 内の指示文が依然として `discovery.json` を参照している。
- `src/ragmaker/utils.py` の `print_discovery_data` など、内部シンボル名に `discovery` が残っており、関心の分離が名前レベルで不明瞭である。

## ゴール（完了の定義）
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `test/test_install_kb.py` ファイルが新規作成され、リポジトリ内に存在している。
- [ ] `src/ragmaker/tools/github_fetch.py` が復元されているか、あるいは `pyproject.toml` から `ragmaker-github-fetch` の定義が削除され、不整合が解消されている。
- [ ] `src/` 配下の全ファイルから、ドキュメントカタログを指す「discovery.json」の記述が完全に排除されている（マスターツールカタログを指す場合を除く）。
- [ ] `src/ragmaker/utils.py` の `print_discovery_data` が `print_catalog_data` に改称され、全ての呼び出し元が修正されている。
- [ ] 各ツールのログメッセージおよび docstring が `catalog` または `データ目録` という表現に統一されている。
- [ ] `src/ragmaker/data/ask.toml` が `catalog.json` を参照するように修正されている。
- [ ] `pytest` を実行し、新規作成した `test/test_install_kb.py` を含む全てのテストがパスしている。

## 解決策の概要
v0.6.1 での「catalog.json への改称」と「install_kb の実装」における不備を解消する。具体的には、欠落していたテストファイルの作成、ソースコード内に残存する旧名称（discovery）の完全なカタログ（catalog）への置換、紛失したツールの復元または定義の整理、および指示書の整合性確保を行う。

## 解決策の詳細

### 1. 内部シンボルおよびメッセージの改称
- `src/ragmaker/utils.py`: `print_discovery_data` → `print_catalog_data` へ改称。
- `src/ragmaker/tools/html_to_markdown.py`: `process_and_update_discovery` → `process_and_update_catalog` へ改称。
- 全ツールの引数ヘルプ（`help="..."`）およびログ出力（`logger.info(...)`）内の `discovery` を `catalog` または `目録` に置換。

### 2. github_fetch.py の不整合解消
- `src/ragmaker/tools/github_fetch.py` が存在するか確認し、存在しない場合は過去のコミット（例: `v0.4.17` 以前）から復元を試みる。
- もし `github_fetch` の機能が他のツールに完全に統合され不要と判断される場合は、`pyproject.toml` および `discovery.json`（マスターツールカタログ）から関連する定義を削除し、システム全体の整合性を保つこと。

### 3. ドキュメントおよび定義ファイルの修正
- `src/ragmaker/tools/http_fetch.py`, `file_sync.py`, `html_to_markdown.py` 等の冒頭 docstring 内にある `Usage` や説明文を修正。
- `src/ragmaker/data/ask.toml` の `prompt` 内にある `discovery.json` を `catalog.json` に修正。

### 3. `test/test_install_kb.py` の実装
以下のケースを網羅するテストを `pytest` で実装する。
- 正常系: `discovery.json`（旧）が存在するディレクトリをソースとして指定し、ターゲットに `catalog.json` として正しくコピー・改称・パス正規化されること。
- 正常系: すでに `catalog.json`（新）が存在するディレクトリからのインストール。
- 異常系: ソースに目録ファイルが存在しない場合のエラーハンドリング。
- 異常系: ターゲットが空でなく、`--force` がない場合の中止処理。

## 参考とすべきスクリプト等
- `src/ragmaker/tools/install_kb.py`
- `test/test_entry_discovery.py` (テスト構造の参考)

## テスト方法
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `test/test_install_kb.py` を新規に作成し、正常系（discovery.json から catalog.json への自動移行）および異常系（ソース欠損等）のテストケースを記述した。
- [ ] `pytest test/test_install_kb.py` を単体で実行し、パスすることを確認した。
- [ ] `pytest` をプロジェクト全域で実行し、既存機能にデグレがないことを確認した。
- [ ] `grep -r "discovery.json" src/` を実行し、マスターツールカタログ以外の文脈でこの文字列が残っていないことを目視で最終確認した。

## 実装状況
- [ ] v0.6.1.1 起草