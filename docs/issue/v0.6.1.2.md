# Issue v0.6.1.2: entry_discovery.py のコード品質向上と出力形式の統一

## 前提知識
- docs/Architecture/Architecture.md
- discovery.json (RAGMakerリポジトリルートにあるマスターツールカタログ)
- src/ragmaker/io_utils.py (標準I/Oユーティリティ)

## 用語の定義
- **RAGMakerリポジトリルート**: 本プロジェクトのソースコードが置かれているルートディレクトリ。
- **マスターツールカタログ**: `RAGMakerリポジトリルート/discovery.json`。全ツールの定義ファイル。
- **ドキュメントカタログ**: ナレッジベース内にあるドキュメント目録ファイル（catalog.json）。

## 経緯
v0.6.1.1 の実装レビューにおいて、`src/ragmaker/tools/entry_discovery.py` に冗長なエラーハンドリングロジックと、プロジェクト標準のJSON出力関数を使用していない箇所が発見された。これらは機能的なバグではないが、保守性と出力の一貫性を損なうため、速やかに修正を行う。

## 現状の問題点
- **二重エラーハンドリング**: `create_initial_catalog` 関数内で例外をキャッチし、ログ出力や独自のエラー処理を行った後で再度 `raise` している。呼び出し元の `main` 関数でも同様に例外をキャッチしているため、エラーメッセージが重複して stderr に出力される。
- **出力形式の不一致**: JSON形式の結果を出力する際、`src/ragmaker/io_utils.py` の `print_json_stdout` を使用せず、`print(json.dumps(...))` を直接呼び出している。これにより、エンコーディング（ensure_ascii）やストリームのフラッシュ処理が他のツールと異なっている。

## ゴール（完了の定義）
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `src/ragmaker/tools/entry_discovery.py` の `create_initial_catalog` 関数から冗長な `try-except` ブロックが削除され、例外処理が `main` 関数に集約されている。
- [ ] `src/ragmaker/tools/entry_discovery.py` が `ragmaker.io_utils.print_json_stdout` を使用して結果を出力している。
- [ ] `pytest test/test_entry_discovery.py` を実行し、既存の全テストケースがパスしている。

## 解決策の概要
`entry_discovery.py` の内部構造を整理し、エラー処理をシンプルに保ちつつ、I/O処理を `io_utils.py` 提供の標準関数へ統合する。これにより、クロスプラットフォームでの出力の安定性を向上させる。

## 解決策の詳細
- **例外処理の整理**: `create_initial_catalog` は、IOError などの例外をキャッチして独自に `handle_io_error` を呼ぶのではなく、例外をそのまま上位に伝播（bubble up）させる。
- **I/Oの統一**: `main` 関数において、成功時の結果出力に `print_json_stdout` を使用する。`io_utils.py` の実装に合わせ、`ensure_ascii=True` による安全な出力を担保する。
- **不要なフォールバックの削除**: パッケージがインストールされている前提の運用にシフトしているため、ツール内の `try: import ... except ImportError: def ...` のような冗長なフォールバックコードを整理し、`io_utils` への依存を明確にする。

## 参考とすべきスクリプト等
- `src/ragmaker/io_utils.py`
- `src/ragmaker/tools/http_fetch.py` (標準的なツール実装例)

## テスト方法
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `pytest test/test_entry_discovery.py` を実行し、正常系（catalog.jsonの新規作成・更新）および異常系（引数不足）が正しく動作することを確認した。
- [ ] 意図的にエラーを発生させ、stderr への出力が重複していないことを確認した。

## 実装状況
- [x] v0.6.1.2 起草
