# Issue v0.3.4

## 前提知識
- docs/Architecture/Architecture.md
- .gemini/commands/rag.md

## 現状の問題点
- エージェントの能力を使って登録することもできているが、決定的な処理はツールに任せることが望ましい。

## 解決策の概要
`entry_discovery`ツールを実装し、`rag`コマンドフローの最終ステップとして、指定されたキャッシュディレクトリ内のドキュメントをシステムに登録する機能を提供する。

## 解決策の詳細
1.  `tools/entry_discovery.py`として新しいPythonスクリプトを作成する。
2.  スクリプトは以下のコマンドライン引数を受け取るようにする。
    - `--path`: 登録対象のドキュメントが格納されているキャッシュディレクトリの絶対パス。
    - `--title`: 登録するドキュメント群全体のタイトル。
    - `--summary`: 登録するドキュメント群全体の要約。
    - `--src-type`: ソースのタイプ（例: `github`, `web`, `local`など）。`discovery.json`の`documents`エントリの`src_type`に対応する。
3.  `--path`で指定されたディレクトリ内の`discovery.json`を読み込み、ドキュメントのメタデータ（ファイルパス、タイトル、要約など）を取得する。
4.  `discovery.json`に記載されている各ドキュメント（Markdownファイル）の内容を読み込む。
5.  読み込んだドキュメントの内容とメタデータを、システムに登録する。登録の際、`--path`で指定されたパスが既に登録されている場合は重複とみなし、既存のドキュメントを新しいもので上書きする。この際、`--src-type`を考慮した登録ロジックを実装する。
6.  登録が成功したことを示すJSON形式の出力を標準出力に書き出す。エラーが発生した場合は、エラー情報をJSON形式で標準エラー出力に書き出す。
7.  適切なロギング（`logging`モジュールを使用）とエラーハンドリングを実装する。
8.  `discovery.json`に`entry_discovery`ツールの定義を追加する。定義は以下の通り。
    ```json
        {
          "name": "entry_discovery",
          "path": "tools/entry_discovery.py",
          "description": "ドキュメントをシステムに登録するツール。",
          "parameters": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string",
                "description": "登録対象のドキュメントが格納されているキャッシュディレクトリの絶対パス。"
              },
              "title": {
                "type": "string",
                "description": "登録するドキュメント群全体のタイトル。"
              },
              "summary": {
                "type": "string",
                "description": "登録するドキュメント群全体の要約。"
              },
              "src-type": {
                "type": "string",
                "description": "ソースのタイプ（例: github, web, localなど）。"
              }
            },
            "required": [
              "path",
              "title",
              "summary",
              "src-type"
            ]
          }
        }
    ```

## 参考とすべきスクリプト等
既存のツール（例: `html_to_markdown.py`や`http_fetch.py`など）の引数解析やJSON出力のパターンを参考にできる。

## テスト方法
モックデータを含むキャッシュディレクトリを作成し、`entry_discovery.py`を実行して、期待されるJSON出力が得られるかを確認する。
