# Issue v0.6.3

## 前提知識
- docs/issue/v0.6.2.md
- .gemini/skills/rag-installer/SKILL.md

## 用語の定義
- **DEST_PARENT**: ユーザーがダイアログで選択した、KBの配置先となる親ディレクトリ。
- **TARGET_PATH**: ソースフォルダ名を含めた、最終的なインストール先の絶対パス。

## 経緯
v0.6.2 で実装した `rag-installer` スキルでは、インストール先として選択したディレクトリそのものに KB の中身がコピーされる仕様となっていた。しかし、一般的なファイル操作の感覚では「コピー元フォルダの名前を維持したまま、指定したディレクトリの下に配置される」ことが期待されるため、ロジックを改善する必要があった。また、破壊的な操作（上書き等）を伴う可能性があるため、実行前の最終確認を導入することとした。

## 現状の問題点
- ターゲットディレクトリを選択した際、その直下に中身が展開されるため、ディレクトリ構造がユーザーの意図と異なる場合があった。
- 実行前に最終的なパスが提示されないため、ユーザーが意図しない場所にインストールしてしまうリスクがあった。

## ゴール（完了の定義）
- [x] `rag-installer` スキルの `SKILL.md` が更新され、ターゲットパスを `DEST_PARENT / (ソースフォルダ名)` として自動計算する手順が記述されている。
- [x] 実行前に、ソースとターゲットのパスをユーザーに提示し、明示的な合意を得るフローが追加されている。

## 解決策の概要
- スキルのインストラクション（プロンプト）を強化し、AIエージェントに「パスの計算」と「ユーザーへの確認」を義務付けた。
- スクリプト側の変更は不要とし、エージェントのオーケストレーション能力で解決した。

## 解決策の詳細
1. **パス計算ロジックの導入**:
   - `SOURCE_PATH` の末尾のフォルダ名を取得。
   - `DEST_PARENT` と結合して `TARGET_PATH` を生成。
2. **インタラクションの追加**:
   - ユーザーに対し「`SOURCE_PATH` から `TARGET_PATH` へインストールします。よろしいですか？」と確認を促す指示を追加。

## テスト方法
- [x] AIエージェントとの対話を通じて、指示通りにパスが計算され、確認が求められることを確認した。
- [x] 正しい `TARGET_PATH` （フォルダ名が付与されたパス）で `ragmaker-install-kb` が実行されることを確認した。

## 実装状況
- [x] `SKILL.md` のプロンプト更新完了。
- [x] スキルの再パッケージ化および再インストール完了。
