# Issue v0.7.10

## 前提知識
- docs/Architecture/Architecture.md
- src/ragmaker/tools/ask_dir.py
- [tkFileBrowser 外部ライブラリ](https://github.com/j4321/tkFileBrowser)

## 経緯
Windows ネイティブ API (`IFileOpenDialog`) の複雑な制約により、これまでの実装ではフォルダの複数選択が不可能であった。この問題を確実に、かつシンプルに解決するため、複数フォルダ選択を標準でサポートする軽量ライブラリ `tkFileBrowser` を導入し、ツールを刷新する。

## 現状の問題点
- フォルダ選択専用のダイアログでは、OS の仕様上、複数のディレクトリを一括でハイライト選択して確定することができない。
- 自前のビット演算やボタンラベルの書き換えは保守性が低く、環境依存の挙動に左右されやすい。

## ゴール（完了の定義）
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `pyproject.toml` の `dependencies` に `tkFileBrowser` が追加されている。
- [ ] `src/ragmaker/tools/ask_dir.py` において、`multiple=True` 時の処理が `tkfilebrowser.askopendirnames` を使用する実装に置き換わっている。
- [ ] Windows 実機において、`ragmaker-ask-dir --multiple` を実行した際、複数のフォルダを Ctrl+クリック等で選択し、一括で確定できる。
- [ ] 選択されたフォルダパスのリストが `selected_directories` として正しい JSON 形式で出力される。
- [ ] `pywin32` (COM API) による複雑な分岐ロジックが整理・簡素化されている。
- [ ] プロジェクト全体の pytest を実行し、全テストがパスしている。

## 解決策の概要
`tkFileBrowser` ライブラリを導入し、その `askopendirnames` 関数を使用することで、OS の制約を回避した確実な複数フォルダ選択を実現する。

## 解決策の詳細
- **依存関係の更新**: `pyproject.toml` に `tkFileBrowser` を追加する。
- **src/ragmaker/tools/ask_dir.py の修正**:
  - `import tkfilebrowser` を追加。
  - `multiple=True` の場合、`tkfilebrowser.askopendirnames(initialdir=initial_dir, title="Select Folders")` を呼び出す。
  - 戻り値（パスのリスト）を JSON 配列として出力する。
  - 既存の `pywin32` を使った COM 呼び出しロジックは、`tkFileBrowser` が期待通り動作することを確認した上で、不要であれば削除してコードをクリーンにする。
- **discovery.json の確認**: `ask_dir` の定義が最新の挙動（複数選択対応）と整合していることを確認する。

## 参考とすべきスクリプト等
- `src/ragmaker/tools/ask_dir.py`
- `tkFileBrowser` 公式ドキュメントの `askopendirnames` 使用例

## テスト方法
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `ragmaker-ask-dir --multiple` を実行し、GUI 上で複数のフォルダを選択・確定して、正しい JSON が得られることを目視確認した。
- [ ] `pytest test/test_ask_dir.py` を更新し、`tkfilebrowser` の呼び出しを検証するモックテストを追加した。

## 実装状況
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] <!-- 完了したマイルストーンを記述 -->
