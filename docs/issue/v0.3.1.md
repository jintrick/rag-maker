# Issue v0.3.1: `/rag`コマンドにおける未実装ツールの実装

## 前提知識
- docs/Architecture/Architecture.md
- .gemini/commands/rag.toml

## 現状の問題点
`/rag`コマンドにおいて、ローカルディレクトリからのファイル取り込み機能（`import_files`ツール）と、RAGMakerシステムへの登録機能（`entry_discovery`ツール）が未実装であるため、`/rag`コマンドの全機能が利用できない。

## 解決策の概要
`import_files`ツールと`entry_discovery`ツールを実装し、`/rag`コマンドのローカルディレクトリからの取り込みとシステム登録機能を完成させる。

## 解決策の詳細
### `entry_discovery`ツール
- 指定されたキャッシュディレクトリのパスをRAGMakerルートの`discovery.json`に登録する機能を実装する。
- **入力パラメータ**:
    *   `path` (必須): 登録するキャッシュディレクトリのパス。
    *   `title` (必須): 登録するドキュメントのタイトル。
    *   `summary` (必須): 登録するドキュメントの概要。
    *   `src_type` (必須): ソースのタイプ（例: `local`, `web`, `github`）。
- **処理内容**:
    *   `discovery.json` を読み込む。
    *   `documents` リストに新しいエントリを追加する。ただし、同じ `path` を持つエントリが既に存在する場合は、既存のエントリを新しいエントリで上書きする。
    *   更新された `discovery.json` を保存する。
- **エラーハンドリング**:
    *   `discovery.json` の読み込み/書き込みエラー。
    *   必須パラメータの不足。

## 参考とすべきスクリプト等
- `.gemini/commands/rag.toml`: `/rag`コマンドのフロー定義
- `discovery.json`: RAGMakerルートのカタログ定義
- 既存のツール（例: `tools/github_fetch.py`, `tools/http_fetch.py`, `tools/html_to_markdown.py`）: ツール実装の参考

## テスト方法
`entry_discovery.py`ツールが正しく機能することを確認するために、以下の手動テストを実施します。

### 1. 新規エントリの追加テスト
1.  ターミナルで以下のコマンドを実行し、新しいドキュメントエントリを追加します。
    ```bash
    python tools/entry_discovery.py --path ".cache/test/doc" --title "Test Document" --summary "This is a test document." --src-type "local"
    ```
2.  コマンドの標準出力に、成功を示すJSONが表示されることを確認します。
    ```json
    {
      "status": "success",
      "message": "Entry added successfully.",
      "entry": {
        "path": ".cache/test/doc",
        "title": "Test Document",
        "summary": "This is a test document.",
        "src_type": "local"
      }
    }
    ```
3.  ルートディレクトリの`discovery.json`ファイルを開き、`documents`リストに新しいエントリが追加されていることを確認します。

### 2. 既存エントリの更新テスト
1.  ターミナルで同じ`path`を指定して、異なる情報でコマンドを再度実行します。
    ```bash
    python tools/entry_discovery.py --path ".cache/test/doc" --title "Test Document Updated" --summary "This is an updated test document." --src-type "local-updated"
    ```
2.  コマンドの標準出力に、更新成功を示すJSONが表示されることを確認します。
    ```json
    {
      "status": "success",
      "message": "Entry updated successfully.",
      "entry": {
        "path": ".cache/test/doc",
        "title": "Test Document Updated",
        "summary": "This is an updated test document.",
        "src_type": "local-updated"
      }
    }
    ```
3.  `discovery.json`ファイルを再度確認し、既存のエントリが新しい情報で上書きされていることを確認します（新しいエントリが追加されていないこと）。

### 3. 後片付け
テスト後は、`discovery.json`に追加したテスト用のエントリを手動で削除するか、gitを使ってファイルを元に戻してください。