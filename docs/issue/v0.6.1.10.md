# Issue v0.6.1.10: ツール出力の純粋化と依存関係テストの完全隔離

## 前提知識
- docs/issue/v0.6.1.9.md
- test/test_package_dependency.py
- src/ragmaker/tools/install_kb.py 等の ImportError ブロック

## 経緯
Issue v0.6.1.9 での依存関係テスト実装において、以下の重大な欠陥が露呈した。第一に、スクリプトを一時ディレクトリへ隔離しても、暗黙的なパス解決により `ImportError` が発生せずテストが偽陰性となること。第二に、`stderr` にロギングメッセージが混入し、ツールが出力する JSON のパースを破壊していることである。これらを根本から解決する。

## 現状の問題点
- **出力の汚染**: `install_kb.py` 等において、`eprint_error` による JSON 出力と `logging` によるテキスト出力が混在し、パース不能な `stderr` を生成している。
- **隔離の形骸化**: 現在の隔離手法（一時ディレクトリへのコピー）では、環境によっては `ImportError` を誘発できず、依存関係チェックが機能していない。
- **検証の不徹底**: パースした JSON がオブジェクト（dict）であることを確認しておらず、想定外の出力に対してテスト自体がクラッシュする脆弱性がある。

## ゴール（完了の定義）
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `ImportError` が発生する状況において、ロギングモジュールの初期化や出力を完全に抑制し、`stderr` には純粋な JSON のみが出力されるよう全ツールが修正されている。
- [ ] `test_package_dependency.py` において、`PYTHONNOUSERSITE` 環境変数の使用や `sys.path` の強制的な書き換え等により、確実に `ImportError` が発生する隔離環境が構築されている。
- [ ] テストコードにおいて、JSON パース後の型検証（`assertIsInstance(data, dict)`）が実装されている。
- [ ] `pytest test/test_package_dependency.py` を実行し、全パラメタライズドテストが確実に「意図した通りの失敗（依存関係エラー）」を検知してパスしている。

## 解決策の概要
ロギングの抑制により出力ストリームを「JSON 専用」として清浄化し、Python のインポート機構を物理的に遮断する強力なテスト隔離ロジックを導入する。

## 解決策の詳細
### 1. ロギングの抑制
各ツールの `ImportError` ブロックにおいて、`logging.basicConfig` が呼ばれる前にエラーを出力して終了させるか、あるいはロガーの伝播を停止させ、JSON 以外の文字列が `stderr` に漏れないように徹底する。

### 2. インポートパスの完全遮断
`test_package_dependency.py` のサブプロセス実行において、`-I` (isolated mode) フラグの使用や、依存ライブラリを物理的に検索不能にするパス操作を行い、現在のソースツリーの影響を完全に排除した状態でテストを遂行する。

## 参考とすべきスクリプト等
- PR #58 における GCA の型検証提案

## テスト方法
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [ ] `pytest test/test_package_dependency.py` を実行し、`json.decoder.JSONDecodeError` が発生せず、かつ全ツールで依存関係エラーが正しく検知されることを確認した。
- [ ] 手動で `src` ディレクトリをリネーム等の手段で隠蔽し、ツールが期待通りの JSON エラーを出すことを目視で確認した。

## 実装状況
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [x] v0.6.1.10 起草
- [ ] ツール出力の純粋化（ロギング抑制）完了
- [ ] 依存関係テストの完全隔離ロジック実装完了
- [ ] 型検証を含むテストコードの堅牢化完了
- [ ] 最終パス確認完了
