# Issue v0.6.1.8: safe_export の Fail-Fast 化とコード重複の排除

## 前提知識
- src/ragmaker/utils.py
- src/ragmaker/tools/file_sync.py
- src/ragmaker/tools/init_cache.py

## 経緯
Issue v0.6.1.7 において `safe_export` の強化と各ツールの堅牢化が行われたが、GCA のレビューおよび「攻撃的解析」により、重大な設計上の欠陥が判明した。衝突回避時のエラー握りつぶしによる「偽の安全」と、スタンドアロン実行用フォールバックによる「大規模なコード重複」を解消し、プロジェクトの保守性を正常化する。

## 現状の問題点
- **エラーの隠蔽 (High Priority)**: `utils.py` の `safe_export` において、衝突するファイルの `unlink` に失敗してもログを出すだけで処理を継続している。これにより、解決不能な状態で `copytree` が実行され、デバッグ困難な二次的エラーを招く。
- **メンテナンス性の崩壊**: 各ツール（`file_sync.py` 等）の `ImportError` ブロックに、`utils.py` のロジックが大規模にコピペされている。本体のバグ修正が反映されない「生きた屍」のようなコードが蔓延している。
- **言語統一方針の形骸化**: `init_cache.py` 等に依然として日本語コメントが残存している。

## ゴール（完了の定義）
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [x] `src/ragmaker/utils.py` の `safe_export` において、`unlink` に失敗した場合は直ちに例外を再送出（`raise`）し、処理を中断している。
- [x] 各ツールの `ImportError` ブロックから、大規模なロジックのコピペ（`safe_export` や `cleanup_dir_contents` の再実装）が削除されている。
    - スタンドアロン実行時は「パッケージのインストールが必要である」旨の明確なエラーを出すか、あるいは真に最小限の機能（既存の `mkdir` 等）に留めている。
- [x] プロジェクト内の全ソースコードから日本語コメントが完全に排除され、英語に統一されている。
- [x] `pytest` を実行し、全テストケースがパスしている。

## 解決策の概要
「 Fail-Fast（即時失敗）」の原則を徹底し、エラーの握りつぶしを禁止する。また、スタンドアロン実行のためにコードの整合性を犠牲にする設計を廃止し、依存関係を正しく管理する形へ回帰する。

## 解決策の詳細
### 1. safe_export の Fail-Fast 化
`src/ragmaker/utils.py` の衝突チェックループにおいて、`dst_path.unlink()` を囲む `try...except OSError` ブロック内で `logger.error` の直後に `raise` を追加する。

### 2. 重複コードの削除
各ツールの `except ImportError` ブロックを整理する。複雑なユーティリティ（`safe_export` 等）をツール側で二重実装してはならない。パッケージがインストールされていない場合は、その事実をユーザーに伝える責務のみを負う。

### 3. 日本語コメントの完全一掃
`src/ragmaker/tools/init_cache.py` 等に残っている日本語コメントをすべて英語に置換する。

## テスト方法
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [x] 権限不足などで `unlink` が失敗する状況を想定し、`safe_export` が適切に失敗（例外送出）することを確認した。
- [x] 各ツールを `PYTHONPATH` を通さない状態で実行し、`NameError` ではなく適切な依存関係エラーが出力されることを確認した。

## 実装状況
実装担当者は、完了報告前に以下の項目をすべて確認し、チェックを入れ、この文書を更新してcommitすること。
- [x] v0.6.1.8 起草
- [x] `safe_export` の Fail-Fast 実装完了
- [x] ツール間の重複コード削除完了
- [x] 日本語コメントの完全排除完了
- [x] 全テストのパス確認完了
