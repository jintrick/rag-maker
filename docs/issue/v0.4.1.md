# Issue v0.4.1: Refactor: Abolish make_cache_dir and delegate responsibility

## 前提知識
- `docs/Architecture/Architecture.md`
- `.gemini/commands/rag.md`
- `tools/make_cache_dir.py`
- `tools/http_fetch.py`, `tools/github_fetch.py`, `tools/file_sync.py`

## 経緯
v0.4.0の実装において、`/rag` コマンドのワークフローは、データ取得ツール（`http_fetch`など）を実行する前に、専用の `make_cache_dir` ツールを呼び出してキャッシュディレクトリを準備する必要があった。

## 現状の問題点
`make_cache_dir` というツールは、責務が細分化されすぎており、AIエージェントのワークフローを不必要に複雑にしている。

- **冗長なステップ**: エージェントは「ディレクトリパスを準備する」→「ディレクトリ作成ツールを呼ぶ」→「データ取得ツールを呼ぶ」という冗長なステップを踏む必要がある。
- **責任の所在が不明確**: ディレクトリを実際に必要とするのはデータ取得ツールであるにもかかわらず、その作成責任を別のツールが担っている。
- **保守性の低下**: ワークフローの変更やツールの追加時に、常にディレクトリ作成のステップを意識する必要があり、保守性を損なっている。

## 解決策の概要
`make_cache_dir.py` ツールを完全に廃止し、ディレクトリ作成の責務を、実際にそのディレクトリを使用する各データ取得ツール（`http_fetch`, `github_fetch`, `file_sync`）に委譲する。

これにより、各ツールは「データを持ってきて、指定された場所に置く（場所がなければ作る）」という、より自己完結した責務を持つことになり、AIエージェントへの指示も簡素化される。

## 解決策の詳細
1.  **`make_cache_dir.py` の廃止**:
    - `tools/make_cache_dir.py` とそのテストファイル `test/test_make_cache_dir.py` をプロジェクトから削除する。

2.  **`discovery.json` の更新**:
    - プロジェクトルートの `discovery.json` から `make_cache_dir` ツールの定義を削除する。

3.  **`.gemini/commands/rag.md` のワークフロー簡略化**:
    - AIエージェントへの指示から `make_cache_dir` を呼び出すステップを削除する。
    - エージェントはキャッシュディレクトリのパスを組み立て、それを直接データ取得ツール（`http_fetch`など）の出力先引数として渡すように指示を修正する。

4.  **各データ取得ツールの機能拡張**:
    - `http_fetch.py`, `github_fetch.py`, `file_sync.py` をそれぞれ修正し、指定された出力先ディレクトリが存在しない場合に自動で作成する機能を追加する (`os.makedirs(..., exist_ok=True)`)。

## 参考とすべきスクリプト等
- `tools/http_fetch.py`
- `tools/github_fetch.py`
- `tools/file_sync.py`

## テスト方法
1.  `test/test_make_cache_dir.py` を削除する。
2.  `http_fetch`, `github_fetch`, `file_sync` の各単体テストを更新または作成し、指定した出力先ディレクトリが存在しない場合に、ツールが正しくディレクトリを作成することを確認するアサーションを追加する。

## 実装状況
テストがパスし、v0.4.1としてリリース。

### コミットメッセージ

```
Refactor: Abolish make_cache_dir and delegate responsibility

The `make_cache_dir` tool introduced an unnecessary and verbose step in the RAG workflow, forcing the agent to explicitly prepare a cache directory before calling the data fetching tools. This created a fragile and overly complex process.

This commit abolishes the `make_cache_dir` tool entirely and delegates the responsibility of directory creation to the tools that require it: `http_fetch`, `github_fetch`, and `file_sync`. These tools already contained the necessary `os.makedirs(..., exist_ok=True)` logic, making this a clean refactoring.

Changes in this commit:
- Deleted `tools/make_cache_dir.py` and its tests.
- Removed the `make_cache_dir` definition from `discovery.json`.
- Simplified the workflow in `.gemini/commands/rag.md` by removing the explicit directory creation step.
- Added new unit tests for `http_fetch`, `github_fetch`, and `file_sync` to verify that they correctly create their output directories if they do not exist.
```
