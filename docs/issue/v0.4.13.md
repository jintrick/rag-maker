# Issue v0.4.13: `print_json_stdout`におけるエンコーディング問題の恒久対策

## 経緯
AIエージェントが`/rag`ワークフローを実行中、`ragmaker-read-file`ツールの標準出力を受け取る際にエンコーディングエラー (`'cp932' codec can't encode character...`) が発生しました。

これは、ツールがUTF-8で出力したJSON文字列を、Windows環境のAIエージェントがデフォルトの`cp932`エンコーディングでデコードしようとしたために発生したものです。JSONの内容に`cp932`で表現できないUnicode文字（例: エムダッシュ `—`）が含まれていたことが直接の原因です。

## 現状の問題点
`ragmaker.io_utils.print_json_stdout`関数は、`json.dumps`を`ensure_ascii=False`で呼び出しています。

これにより、日本語や特殊記号がそのままUTF-8文字列として出力されますが、この出力を`cp932`でデコードしようとすると、互換性のない文字で`UnicodeDecodeError`が発生し、ツール間のデータ連携が失敗します。

この問題は、`print_json_stdout`を使用するすべてのツール（`read_file`, `http_fetch`, `enrich_discovery`など多数）に共通する潜在的な脆弱性です。

## 解決策の概要
`ragmaker.io_utils.print_json_stdout`を修正し、`json.dumps`の`ensure_ascii`オプションを`True`に設定します。

## 解決策の詳細
1.  **`ragmaker/io_utils.py` の修正**:
    -   `print_json_stdout`関数内の`json.dumps`呼び出しを`ensure_ascii=True`に変更します。
    -   これにより、すべての非ASCII文字が`\uXXXX`形式にエスケープされます。
    -   出力されるJSON文字列は純粋なASCII文字のみで構成されるため、`cp932`を含む任意のエンコーディングで安全に送受信できます。
    -   受信側（AIエージェント）は、このJSON文字列を標準のJSONライブラリでパースするだけで、エスケープされたシーケンスが自動的に元のUnicode文字に復元されます。
    -   この変更により、プラットフォーム間のエンコーディングの差異に起因する問題を根本的に解決します。

```diff
--- a/src/ragmaker/io_utils.py
+++ b/src/ragmaker/io_utils.py
@@ -47,14 +47,20 @@
         data (dict[str, Any]): The dictionary to be printed as JSON.
     """
     try:
-        json_string = json.dumps(data, ensure_ascii=False, indent=2)
+        # ensure_ascii=True is critical for cross-platform/encoding compatibility.
+        # It escapes all non-ASCII characters, making the output safe for any
+        # text stream, including those expecting cp932.
+        json_string = json.dumps(data, ensure_ascii=True, indent=2)
         print(json_string)
     except Exception as e:
         # Fallback in case of serialization errors.
         fallback_data = {
             "status": "error",
             "error_code": "JSON_SERIALIZATION_ERROR",
             "message": "Failed to serialize data to JSON for stdout.",
             "details": str(e)
         }
-        print(json.dumps(fallback_data, ensure_ascii=False))
+        print(json.dumps(fallback_data, ensure_ascii=True))
```

## テスト方法
1.  `ragmaker-read-file`ツールを使って、エムダッシュ(`—`)や絵文字(`😊`)などの`cp932`非互換文字を含むファイルを読み込ませます。
2.  ツールがエラーなく終了し、標準出力に`\uXXXX`形式でエスケープされたJSON文字列が出力されることを確認します。
3.  `/rag`コマンドのワークフローを再実行し、エンコーディングエラーが発生せずに最後まで完了することを確認します。