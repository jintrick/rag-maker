# Issue v0.2.4:

## 前提知識
- docs/Architecture/Architecture.md

## 現状の問題点
- `/rag`コマンド（`.gemini/commands/rag.toml`）において、WebページやGitHubリポジリをソースとする場合に、ユーザーにマークダウン文書群の保存ディレクトリを尋ねる `ask_dir` ツールが未実装である。これにより、生成されたマークダウン文書の保存先が不明確であり、ユーザーが意図しない場所にファイルが作成される可能性がある。

## 解決策の概要
`/rag` コマンド実行時、WebページまたはGitHubリポジリをソースとして指定した場合に、ユーザーに対してマークダウン文書群の保存先ディレクトリを対話的に尋ねる `ask_dir` ツールを実装し、既存のワークフローに組み込む。これにより、ユーザーは生成されるマークダウン文書の保存先を明示的に指定できるようになり、ファイルの管理性が向上する。

## 解決策の詳細
1.  **`ask_dir` ツールの実装:**
    *   Pythonの `tkinter` ライブラリを使用して、ユーザーがディレクトリを選択できるシンプルなGUIウィンドウを実装する。
    *   このGUIは、`ask_dir` ツールが呼び出された際に表示され、ユーザーがディレクトリを選択し「OK」ボタンを押すことで、選択されたディレクトリの絶対パスを返す。
    *   ツールは、選択されたパスを標準出力（stdout）にJSON形式で出力する。
        *   **成功時:** `{"status": "success", "selected_directory": "/path/to/selected/directory"}`
        *   **キャンセル時/エラー時:** `{"status": "error", "error_code": "USER_CANCELLED", "message": "Directory selection was cancelled by the user.", "remediation_suggestion": "Please re-run the command and select a directory."}`
    *   エラーハンドリングとして、ユーザーがディレクトリを選択せずにウィンドウを閉じた場合やキャンセルした場合の挙動を定義する。
2.  **`/rag` コマンドへの統合:**
    *   `.gemini/commands/rag.toml` の `prompt` 内で、WebページおよびGitHubリポジリをソースとするフローにおいて、`html_to_markdown` ツール実行後に `ask_dir` ツールを呼び出すように変更する。
    *   `ask_dir` ツールからのJSON出力をパースし、`selected_directory` の値を取得する。
    *   取得したディレクトリパスを、生成されたマークダウン文書の保存先として利用する。具体的には、`write_file` ツールで `discovery.json` やマークダウンファイルを書き込む際に、このパスを基点として利用する。
3.  **既存のツールとの連携:**
    *   `web_fetch` および `github_fetch` ツールが一時ディレクトリにファイルを保存する際、その一時ディレクトリのパスを `ask_dir` ツールに渡すことで、ユーザーがデフォルトの保存先として一時ディレクトリの親ディレクトリなどを選択しやすくする。

## 参考とすべきスクリプト等
-   **`tools/web_fetch.py` および `tools/github_fetch.py`:**
    *   これらのスクリプトは、ツールの標準出力（stdout）および標準エラー出力（stderr）へのJSON形式での結果出力、およびエラーハンドリングのパターンを理解する上で参考になる。
    *   一時ディレクトリへのファイル保存など、ファイル操作の参考にもなる。
-   **Python標準ライブラリ `tkinter` のドキュメント:**
    *   ディレクトリ選択ダイアログの実装には、`tkinter.filedialog` モジュールの `askdirectory` 関数が直接的に利用できるため、その使用方法を公式ドキュメントで確認する。
-   **Python標準ライブラリ `json` のドキュメント:**
    *   JSONデータのパース（`json.loads`）および生成（`json.dumps`）の具体的な方法について、公式ドキュメントを参照する。

## テスト方法
Julesは、上記の問題点と解決策の詳細に基づき、`ask_dir` ツールの実装および `/rag` コマンドへの統合が正しく行われたことを検証するためのテスト方法を自律的に定義し、実行すること。。