
ソース（`{{args}}`）をナレッジソースとして取り込みます。
ワークフローに従い、以下のタスクを完了させてください。

## 0. ナレッジベースの選択
まず、ナレッジベースのルートディレクトリをユーザーに尋ねてください。
`ask_dir`ツールを実行し、ユーザーが選択したディレクトリのパスを変数`<KB_ROOT>`に格納してください。
以降のすべてのファイルパスの解決は、この`<KB_ROOT>`を基準に行います。

## 1. ソースタイプ毎の処理フロー
ソースの種別に応じて、以下のいずれかのフローを実行してください。ツールの発見には`<KB_ROOT>/discovery.json`を使うことができます。

### A) ソースが GitHubリポジトリ の場合
1.  **キャッシュディレクトリ準備:** `<リポジトリオーナー名>/<リポジトリ名>/` の規則でキャッシュディレクトリ名を決定し、`make_cache_dir`ツールを `--kb-root <KB_ROOT>` オプション付きで実行してディレクトリを作成します。
2.  **フェッチ:** `github_fetch`ツールを実行します。この際、`--dest-dir`には `<KB_ROOT>/cache/<キャッシュディレクトリ名>` を指定してください（※）。

### B) ソースが Webページ の場合
1.  **キャッシュディレクトリ準備:** `<ドメイン名>/` の規則でキャッシュディレクトリ名を決定し、`make_cache_dir`ツールを `--kb-root <KB_ROOT>` オプション付きで実行してディレクトリを作成します。`<ドメイン名>/<サブドメイン名>`とすべきかどうかはケースバイケースです。そのドメイン固有のドキュメントではないと推測される場合などは、この形式が相応しいということになります。キャッシュディレクトリ内における一意性が確保できればよいのですが、念のためユーザーにも確認を取ってください。
2.  **フェッチ:** `http_fetch`ツールを実行します。この際、`--dest-dir`には `<KB_ROOT>/cache/<キャッシュディレクトリ名>` を指定してください（※）。

### C) ソースが ローカルディレクトリ の場合
1.  **キャッシュディレクトリ準備:** ソースの絶対パス（例: `C:\users\amg\` または `/home/user/documents/`）を基に、`<正規化された絶対パス>` の規則でキャッシュディレクトリ名を決定し、`make_cache_dir`ツールを `--kb-root <KB_ROOT>` オプション付きで実行してディレクトリを作成します。正規化された絶対パスは、ドライブレター（Windowsの場合）を含め、パス区切り文字をスラッシュに統一し、特殊文字を適切にエスケープまたは置換してください（`C:\users\amg` -> `/c/users/amg/`）。
2.  **ファイルコピー:** `file_sync`ツールを実行します。この際、`--dest-dir`には `<KB_ROOT>/cache/<キャッシュディレクトリ名>` を指定してください（※）。

※各種ツールの所在及び使い方は、`<KB_ROOT>/discovery.json`に定義されています。

## 2. 共通の最終ステップ
フローが完了した後、以下の共通ステップを実行してください。
1.  **Markdown変換:** `html_to_markdown` を実行し、`--target-dir`に`<KB_ROOT>`を基準としたキャッシュディレクトリのパスを指定してください。(このツールはインプレースで動作し、HTMLソースを削除して`discovery.json`を更新します。)
2.  **キャッシュクリーンアップ:** `cache_cleanup`ツールを実行し、`--target-dir`に`<KB_ROOT>`を基準としたキャッシュディレクトリのパスを指定してください。これにより、Markdownと`discovery.json`以外の不要なファイル（例：画像、スクリプトファイルなど）がすべて削除されます。
3.  **エンリッチ:** キャッシュディレクトリ内の`discovery.json`を完成させます。キャッシュディレクトリ内の文書を順次読み込み、エージェントは、自らの推論能力を用いて、`title` と `summary` 埋めて完成させてください。
4.  **システムへの登録:**
    - `entry_discovery`ツールを実行します。この際、必須の引数（`--path`, `--src-type`, `--title`, `--summary`）に加えて、**必ず `--kb-root <KB_ROOT>` と `--source-url` 引数を指定してください。** `--source-url` には `/rag`コマンドで受け取った元のソースURLを指定します。ツールの詳細な使用方法（引数など）は、`<KB_ROOT>/discovery.json`を参照してください。
5.  ユーザーに登録完了を告げ、登録した文書の内容に関して何か質問をうながします。