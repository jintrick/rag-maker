ソース（`{{args}}`）をナレッジソースとして取り込みます。
ワークフローに従い、以下のタスクを完了させてください。
ツールの使い方や引数の詳細は`discovery.json`を参照し、自律的に判断して実行してください。

## ツールの実行方法
あなたが利用するツール群は、`pip install -e .` によってシステムにコマンドとしてインストールされています。この仕組みは、`pyproject.toml` の `[project.scripts]` セクションで定義されています。

ツールを実行する際は、プロジェクトルートの `discovery.json` を参照してください。各ツール定義に含まれる `command` キーの値が、この**インストール済みのコマンド名**です。

例えば、`create_knowledge_base` ツールを実行する場合、`discovery.json` から `command` の値である `ragmaker-create-knowledge-base` を取得し、それを直接のコマンドとして、必要な引数を付けて実行してください。

---
## ワークフロー

### 0. ナレッジベースのセットアップ
1.  **ナレッジベースの場所をユーザーに確認する。**
    -   `ask_dir` ツールを実行し、ユーザーが選択したパス (`selected_directory`) を取得し、これをナレッジベースのルートパス (`kb_root`) とする。
2.  **ナレッジベースの基本構造を作成する。**
    -   取得した `kb_root` を引数として `create_knowledge_base` ツールを実行する。

**これ以降のすべてのステップでは、このステップで決定した `{{kb_root}}` を基準に、すべてのファイルパスを解決してください。**

### 1. データ取得と一時保存
1.  **データ取得:** ソースの種類に応じて、適切なデータ取得ツール（`http_fetch` や `github_fetch` など）を実行してください。
    -   **ファイル出力**: 各ツールのファイル出力先として、`{{kb_root}}/cache/` を指定します。
    -   **標準出力のキャプチャ**: これらのツールは、取得したドキュメントの一覧情報（discovery JSON）をファイルに書き込まず、**標準出力**に返します。この標準出力を、後のステップで使用するためにキャプチャしてください。
2.  **一時ファイルへ保存:**
    -   キャプチャした標準出力の内容を `content` として、`write_file` ツールを呼び出します。
    -   `--path`には、一時的な場所として `.tmp/discovery.json` を指定します。

### 2. データ変換
1.  **Markdown変換:** (Webソースの場合など) `html_to_markdown`ツールを実行し、`{{kb_root}}/cache/` 内のHTMLファイルをMarkdownに変換します。このツールはインプレースで動作し、`discovery.json`も自動で更新します。

### 3. キャッシュクリーンアップ
1.  **不要ファイルの削除:** `cache_cleanup`ツールを実行し、RAGに不要な中間ファイル（HTMLソースなど）を削除して、`{{kb_root}}/cache/` ディレクトリを整理します。

### 4. ドキュメントのエンリッチ (新ワークフロー)
**ここがパフォーマンス改善の核心部分です。ファイルI/Oを最小限に抑えるため、以下の手順を厳密に守ってください。**

1.  **全ドキュメントのパスを収集:**
    -   `read_file` ツールを使い、`.tmp/discovery.json` **のみ**を読み込みます。
    -   読み込んだJSONデータから、`documents` 配列内の各要素の `path` キーの値をすべて抽出し、**ファイルパスのリスト**をあなたのメモリ上に作成します。
2.  **全ドキュメントの内容を一括読み込み:**
    -   `read_file` ツールを**一度だけ**呼び出します。
    -   `--path`引数として、先ほど作成したファイルパスのリストをすべて渡します。（例: `--path path1.md --path path2.md ...`）
    -   これにより、全ドキュメントの内容が単一のJSONオブジェクトとして取得できます。
3.  **メモリ上でのエンリッチ処理:**
    -   ステップ1で読み込んだ `discovery.json` の内容（Pythonの辞書オブジェクト）を、あなたのメモリ上で直接更新していきます。
    -   ステップ2で取得した全ドキュメントの内容（`content`）を参照し、各ドキュメントに対応する `title` と `summary` をあなたの推論能力で生成します。
    -   生成した `title` と `summary` を、メモリ上にある `discovery.json` の辞書オブジェクト内の、対応するドキュメントエントリに追加・更新します。
4.  **エンリッチ済みJSONの書き戻し:**
    -   エンリッチ処理が完了したメモリ上の辞書オブジェクトを、JSON文字列に変換します。
    -   `write_file` ツールを使い、このJSON文字列を `.tmp/discovery.json` に**上書き保存**します。

### 5. メタデータ登録と最終配置
1.  **ナレッジベース全体のメタデータ生成:**
    -   エンリッチ済みの `.tmp/discovery.json` の内容（JSON文字列）を再度メモリに読み込みます。
    -   `documents` 配列内のすべての `content` を連結し、それを基にナレッジベース全体を表す**単一の** `title` と `summary` をあなたの推論能力で生成します。
2.  **最終登録:**
    -   `entry_discovery` ツールを呼び出します。`--kb-root` に `{{kb_root}}` を、`--title` と `--summary` には今あなたが生成したものを、`--source-url` と `--src-type` にはワークフローの初期段階で与えられた情報を指定してください。
3.  **完成したファイルの移動:**
    -   `move_file` ツールを呼び出します。
    -   `--source` に `.tmp/discovery.json` を指定します。
    -   `--destination` に最終的な配置場所である `{{kb_root}}/cache/discovery.json` を指定します。

### 6. 完了報告
1.  **ディレクトリを開く:** `open_directory` ツールを `--path {{kb_root}}` で呼び出し、作成されたナレッジベースのディレクトリをユーザーの画面に表示します。
2.  **ユーザーへのメッセージ:** ツール実行後、以下のメッセージをユーザーに伝えてください。
    > ナレッジベースが作成されました。表示されたウィンドウ内でターミナルを開き、`/ask` コマンドで質問を開始してください。