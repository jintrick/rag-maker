ソース（`{{args}}`）をナレッジソースとして取り込みます。
ワークフローに従い、以下のタスクを完了させてください。
ツールの使い方や引数の詳細は`discovery.json`を参照し、自律的に判断して実行してください。

## 注意事項
- あなたが利用するツール群は、すべて`discovery.json`にコマンドや引数が定義されています。これを読まないとフローを進めることができません。最初に、`discovery.json`を読み込んでください。
- あなたが利用するツール群は、`pip install -e .` によってシステムにコマンドとしてインストールされています。この仕組みは、`pyproject.toml` の `[project.scripts]` セクションで定義されています。
- パスの指定は相対パスで行ってください。絶対パスを指定する際には、スペースが含まれているケースを考慮して**ダブルクォーテーション**を使ってください。


---
## ワークフロー

### 0. ナレッジベースのセットアップ
**注意:** 最初に、`discovery.json`を読み込んでください。
1. 「ナレッジベースのパスを選択するダイアログを表示します」と告げ、`ask_dir` ツールを実行する。これをナレッジベースのルートパス (`kb_root`) とする。
2. 取得した `kb_root` を引数として `create_knowledge_base` ツールを実行する。

### 1. データ取得と一時保存
**注意:** 最初に、`discovery.json`を読み込んでください。
1.  **データ取得:** ソースの種類に応じて、適切なデータ取得ツール（`http_fetch` や `github_fetch` など）を実行する。
    -   **ファイル出力**: 各ツールのファイル出力先として、`{{kb_root}}/cache/` を指定する。
    -   **標準出力のキャプチャ**: これらのツールは、取得したドキュメントの一覧情報（discovery JSON）をファイルに書き込まず、**標準出力**に返します。この標準出力を、後のステップで使用するためにキャプチャする。
2.  **一時ファイルへ保存:**
    -   キャプチャした標準出力の内容を `content` として、`write_file` ツールを呼び出します。
    -   `--path`には、一時的な場所として `<プロジェクトルート>/.tmp/discovery.json` を指定します。

### 2. データ変換 (リファクタリング後)
**注意:** 最初に、`discovery.json`を読み込んでください。
1.  **Markdown変換の実行:**
    -   WebソースなどのHTMLファイルを変換する必要がある場合、`html_to_markdown` ツールを呼び出します。
    -   `--input-dir`にはHTMLファイルが格納されている `{{kb_root}}/cache/` を指定します。
    -   `--discovery-path`には、更新のベースとなる `<プロジェクトルート>.tmp/discovery.json` を指定します。
    -   このツールは、変換後の `discovery.json` の内容全体を**標準出力**に返します。この出力をキャプチャしてください。
2.  **一時ファイルの更新:**
    -   キャプチャした標準出力の内容を `content` として、`write_file` ツールを再度呼び出します。
    -   `--path` に `.tmp/discovery.json` を指定し、ファイルを**上書き**します。
    -   これにより、`discovery.json` への変更が `.tmp/` ディレクトリ内で完結します。

### 3. キャッシュクリーンアップ
**注意:** 最初に、`discovery.json`を読み込んでください。
1.  **不要ファイルの削除:** `cache_cleanup`ツールを実行し、RAGに不要な中間ファイル（HTMLソースなど）を削除して、`{{kb_root}}/cache/` ディレクトリを整理します。

### 4. ドキュメントのエンリッチ
**ファイルI/Oを最小限に抑えるため、以下の手順を厳密に守ってください。**
**注意:** 最初に、`discovery.json`を読み込んでください。
1.  **全ドキュメントの内容を一括で読み込む:**
    -   `read_file` ツールを**一度だけ**呼び出します。
    -   まず、`read_file` で `<プロジェクトルート>.tmp/discovery.json` を読み、`documents` 配列から全ドキュメントの `path` のリストを抽出します。
    -   次に、抽出したパスのリストを `read_file` ツールの `--path` 引数にすべて渡して実行します。（例: `--path path1.md --path path2.md ...`）
    -   ツールは、各ファイルの内容を含むJSONを返します。

2.  **エンリッチ情報の生成:**
    -   `read_file` から返された全ドキュメントの内容を基に、各ドキュメントの `title` と `summary` をあなたの推論能力で生成します。
    -   結果を、以下の形式を持つオブジェクトの**配列**としてメモリ上に構築します。AIの仕事は、この配列を生成することだけです。
        ```json
        [
          {"path": "path/to/doc1.md", "title": "...", "summary": "..."},
          {"path": "path/to/doc2.md", "title": "...", "summary": "..."}
        ]
        ```

3.  **一括更新の実行:**
    -   `enrich_discovery` ツールを呼び出します。
    -   `--discovery-path` 引数に、更新対象である `<プロジェクトルート>/.tmp/discovery.json` のパスを指定します。
    -   `--updates` 引数に、ステップ2で生成したJSON配列を**文字列として**渡します。
    -   このツールが、`<プロジェクトルート>.tmp/discovery.json` への安全かつ効率的な書き込みを実行します。

### 5. メタデータ登録と最終配置
**注意:** 最初に、`discovery.json`を読み込んでください。
1.  **ナレッジベース全体のメタデータ生成:**
    -   `read_file` ツールを使い、エンリッチ済みの `<プロジェクトルート>.tmp/discovery.json` の内容を読み込みます。
    -   `documents` 配列内のすべてのドキュメントの `summary` を連結し、それを基にナレッジベース全体を表す**単一の** `title` と `summary` をあなたの推論能力で生成します。
2.  **最終登録:**
    -   `entry_discovery` ツールを呼び出します。`--kb-root` に `{{kb_root}}` を、`--title` と `--summary` には今あなたが生成したものを、`--source-url` と `--src-type` にはワークフローの初期段階で与えられた情報を指定してください。
3.  **完成したファイルの移動:**
    -   `move_file` ツールを呼び出します。
    -   `--source` に `<プロジェクトルート>.tmp/discovery.json` を指定します。
    -   `--destination` に最終的な配置場所である `{{kb_root}}/cache/discovery.json` を指定します。

### 6. 完了報告
**注意:** 最初に、`discovery.json`を読み込んでください。
1.  **ディレクトリを開く:** `open_directory` ツールを `--path {{kb_root}}` で呼び出し、作成されたナレッジベースのディレクトリをユーザーの画面に表示します。
2.  **ユーザーへのメッセージ:** ツール実行後、以下のメッセージをユーザーに伝えてください。
    > ナレッジベースが作成されました。表示されたウィンドウ内でターミナルを開き、`/ask` コマンドで質問を開始してください。