
ソース（`{{args}}`）をナレッジソースとして取り込みます。
ワークフローに従い、以下のタスクを完了させてください。

**重要:** 各ツールの正確な使用方法（引数、オプションなど）については、必ず discovery.jsonを参照してください。

## 0. ナレッジベースの選択
まず、「なれっじべーすを」ナレッジベースのルートディレクトリをユーザーに尋ねてください。
1. `discovery.json`を読んで`ask_dir`ツールを発見、使い方を理解してください。
2. `ask_dir`ツールを実行してください。
3. ユーザーが選択したディレクトリのパスを変数`<KB_ROOT>`に格納してください。

## 1. ソースタイプ毎の処理フロー
ソースの種別に応じて、以下のいずれかのフローを実行してください。ツールの発見と使用法は`discovery.json`を必ず参照してください。

### A) ソースが GitHubリポジトリ の場合
1.  **キャッシュディレクトリ準備:** `make_cache_dir`ツールを `--kb-root <KB_ROOT>` で実行し、`<KB_ROOT>/cache/` ディレクトリを準備します。
    - まず、ソースURL `{{args}}` から、ファイルシステムで安全に使える一意なディレクトリ名を生成してください（例: `https://github.com/user/repo` -> `github-com-user-repo`）。
    - 次に、`make_cache_dir`ツールを `--kb-root <KB_ROOT> --relative-path <生成した一意なディレクトリ名>` のように実行します。
    - 生成されたディレクトリのフルパスを変数 `<CACHE_DIR>` に格納してください。
2.  **フェッチ:** `github_fetch`ツールを実行します。`--temp-dir`には `<CACHE_DIR>` を指定してください。
※ツールの発見には、必ず`discovery.json` を参照してください。これ以降は書きませんので必ず守ってください。

### B) ソースが Webページ の場合
1.  **キャッシュディレクトリ準備:** 上記「A) GitHubリポジトリの場合」と同様の手順で、ソースURLから一意なディレクトリ名を生成し、`make_cache_dir`ツールで専用のキャッシュディレクトリを作成後、そのパスを変数 `<CACHE_DIR>` に格納してください。
2.  **フェッチ:** `http_fetch`ツールを実行します。`--output-dir`には `<CACHE_DIR>` を指定してください。

### C) ソースが ローカルディレクトリ の場合
1.  **キャッシュディレクトリ準備:** 上記「A) GitHubリポジトリの場合」と同様の手順で、ソースパスから一意なディレクトリ名を生成し、`make_cache_dir`ツールで専用のキャッシュディレクトリを作成後、そのパスを変数 `<CACHE_DIR>` に格納してください。
2.  **ファイルコピー:** `file_sync`ツールを実行します。`--dest-dir`には `<CACHE_DIR>` を指定してください。

## 2. 共通の最終ステップ
フローが完了した後、以下の共通ステップを実行してください。
1.  **Markdown変換:** `html_to_markdown` を実行し、`--target-dir`に `<CACHE_DIR>` を指定してください。(このツールはインプレースで動作し、HTMLソースを削除して`discovery.json`を更新します。)
2.  **キャッシュクリーンアップ:** `cache_cleanup`ツールを実行し、`--target-dir`に `<CACHE_DIR>` を指定してください。これにより、RAGに不可欠なMarkdownファイルと`discovery.json`以外の不要なファイル（例：画像、スクリプトファイルなど）がすべて削除されます。
3.  **エンリッチ:** `<CACHE_DIR>/discovery.json` を完成させます。キャッシュディレクトリ内の文書を順次読み込み、エージェントは、自らの推論能力を用いて、`title` と `summary` 埋めて完成させてください。
4.  **システムへの登録:**
    - `entry_discovery`ツールを実行します。
    - **注意:** このツールは `<KB_ROOT>/discovery.json` を更新します。`--path`には `<CACHE_DIR>` を指定してください。
    - 必須の引数（`--path`, `--src-type`, `--title`, `--summary`）に加えて、**必ず `--kb-root <KB_ROOT>` と `--source-url` 引数を指定してください。** `--source-url` には `/rag`コマンドで受け取った元のソースURLを指定します。
    - ツールの詳細な使用方法（引数など）は、プロジェクトルートの`discovery.json` を参照してください。
5.  ユーザーに登録完了を告げ、登録した文書の内容に関して何か質問をうながします。