ソース（`{{args}}`）をナレッジソースとして取り込みます。
ワークフローに従い、以下のタスクを完了させてください。
Pythonスクリプトツールの使い方や引数の詳細は`discovery.json`を参照し、自律的に判断して実行してください。

## 0. ナレッジベースの新規作成
1. まず、`discovery.json`を読み込みます。
2. `ask_dir` ツールを使い、新しいナレッジベースを作成する場所をユーザーに選択してもらいます。
3. ユーザーが選択したパスを引数として `create_knowledge_base` ツールを実行し、ナレッジベースの基本構造（`.gemini` ディレクトリ、`cache` ディレクトリ、初期 `discovery.json`）をセットアップします。

**これ以降のすべてのステップでは、このステップでセットアップした `{{kb_root}}` を基準に、すべてのファイルパスを解決してください。**

## 1. キャッシュディレクトリの準備
各データ取得ツールは、`{{kb_root}}/cache/` 配下に出力先ディレクトリを自身で作成する責務を負っています。
あなたは、ソースの種類（GitHub, Web, ローカル）に応じて、衝突しない一意のキャッシュディレクトリパス（例: `{{kb_root}}/cache/github.com/owner/repo`）を構築し、それを各ツールの出力先として渡してください。

## 2. ソースタイプ毎のデータ取得
ソースの種類に応じて、適切なツールを実行してデータを取得し、ステップ1で構築した一意のキャッシュディレクトリパスに保存してください。

*   **GitHubリポジトリの場合:** `github_fetch`ツールを実行します。
*   **Webページの場合:** `http_fetch`ツールを実行します。
*   **ローカルディレクトリの場合:**
    1.  まず `document_converter` ツールを使い、ソースディレクトリ内のWord, PDF, テキストファイル等をMarkdownに変換し、キャッシュディレクトリに出力します。
    2.  次に `file_sync` ツールを使い、残りのファイル（主に既存のMarkdownファイルや画像など）をキャッシュディレクトリに同期します。

## 3. 共通の最終ステップ
データ取得後、以下の共通ステップを順に実行してください。
1.  **Markdown変換:** `html_to_markdown`ツールを実行し、取得したHTMLファイルをMarkdownに変換します。このツールはインプレースで動作します。
2.  **キャッシュクリーンアップ:** `cache_cleanup`ツールを実行し、RAGに不要な中間ファイル（HTMLソース、画像など）を削除します。
3.  **メタデータエンリッチ:** キャッシュディレクトリ内の`discovery.json`を読み込み、あなたの推論能力を使って各ドキュメントの`title`と`summary`を補完してください。
4.  **システムへの登録:** `entry_discovery`ツールを実行して、ナレッジベースにドキュメント情報を登録します。
    *   このツールは、`{{kb_root}}/discovery.json`を更新します。
    *   `--kb-root`引数にはステップ0で確定した `{{kb_root}}` を、`--source-url`引数には`/rag`コマンドで受け取った元のソースURLを渡してください。
    *   `--path`引数にはステップ1で構築したキャッシュディレクトリのパスを渡してください。その他の必須引数（`--src-type`, `--title`, `--summary`）も適切に設定してください。
5.  **完了報告:** ユーザーに登録完了を告げ、登録した文書の内容について質問を促してください。