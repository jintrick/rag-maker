ソース（`{{args}}`）をナレッジソースとして取り込みます。
ワークフローに従い、以下のタスクを完了させてください。
ツールの使い方や引数の詳細は`discovery.json`を参照し、自律的に判断して実行してください。

## 注意事項
- あなたが利用するツール群は、すべて`discovery.json`にコマンドや引数が定義されています。これを読まないとフローを進めることができません。最初に、`discovery.json`を読み込んでください。
- あなたが利用するツール群は、`pip install -e .` によってシステムにコマンドとしてインストールされています。この仕組みは、`pyproject.toml` の `[project.scripts]` セクションで定義されています。
- パスの指定は相対パスで行ってください。絶対パスを指定する際には、スペースが含まれているケースを考慮して**ダブルクォーテーション**を使ってください。


---
## ワークフロー

### 0. ナレッジベースのセットアップ
**注意:** 最初に、`discovery.json`を読み込んでください。
1. 「ナレッジベースのパスを選択するダイアログを表示します」と告げ、`ask_dir` ツールを実行する。これをナレッジベースのルートパス (`kb_root`) とする。
2. 取得した `kb_root` を引数として `create_knowledge_base` ツールを実行する。

### 1. データ取得と一時保存
**注意:** 最初に、`discovery.json`を読み込んでください。

**ソース `{{args}}` の種類を判断し、以下のいずれかのフローを実行してください。**

#### A) Webソースの場合 (`http` または `https` で始まるURL)
1.  **データ取得と変換:** `http_fetch` ツールを実行します。
    -   `--url` に `{{args}}` を指定します。
    -   `--base-url` には、収集範囲の基点となるURLを指定します（`{{args}}` から適切に判断してください）。
    -   `--output-dir` に `{{kb_root}}/cache/` を指定します。
    -   このツールは、HTMLの取得、本文抽出、Markdown変換までをすべて行い、結果のJSONを**標準出力**に返します。
2.  **一時ファイルへ保存:** `http_fetch` の標準出力をキャプチャし、`write_file` ツールを使って `<プロジェクトルート>/.tmp/discovery.json` に保存します。
3.  **次のステップへ:** このフローの場合、**ステップ2と3は不要**です。**ステップ4. ドキュメントのエンリッチ** に進んでください。
3.  **次のステップへ:** **ステップ2. ドキュメントのエンリッチ** に進んでください。

#### B) GitHubソースの場合 (`github.com` を含むURL)
1.  **データ取得と変換:** `github_fetch` ツールを実行します。
    -   `--repo-url` に `{{args}}` を指定します。
    -   `--path-in-repo` には、リポジトリ内の収集対象パスを指定します（`{{args}}` から適切に判断してください）。
    -   `--output-dir` に `{{kb_root}}/cache/` を指定します。
    -   このツールは、HTMLファイルをMarkdownに変換し、取得した全ファイルの一覧をJSONとして**標準出力**に返します。
2.  **一時ファイルへ保存:** `github_fetch` の標準出力をキャプチャし、`write_file` ツールを使って `<プロジェクトルート>/.tmp/discovery.json` に保存します。
3.  **次のステップへ:** このフローの場合、**ステップ2と3は不要**です。**ステップ4. ドキュメントのエンリッチ** に進んでください。
3.  **次のステップへ:** **ステップ2. ドキュメントのエンリッチ** に進んでください。

#### C) ローカルディレクトリの場合 (上記以外のパス)
1.  **データ取得と変換:** `file_sync` ツールを実行します。
    -   `--source-dir` に `{{args}}` を指定します。
    -   `--dest-dir` に `{{kb_root}}/cache/` を指定します。
    -   このツールは、ファイルの変換と同期を行い、処理されたファイル一覧のJSONを**標準出力**に返します。
2.  **一時ファイルへ保存:** `file_sync` の標準出力をキャプチャし、`write_file` ツールを使って `<プロジェクトルート>/.tmp/discovery.json` に保存します。
3.  **次のステップへ:** このフローの場合、**ステップ2と3は不要**です。**ステップ4. ドキュメントのエンリッチ** に進んでください。
3.  **次のステップへ:** **ステップ2. ドキュメントのエンリッチ** に進んでください。

### 2. ドキュメントのエンリッチ
**ファイルI/Oを最小限に抑えるため、以下の手順を厳密に守ってください。**
**注意:** 最初に、`discovery.json`を読み込んでください。
1.  **全ドキュメントの内容を一括で読み込む:**
    -   `read_file` ツールを**一度だけ**呼び出します。
    -   まず、`read_file` で `<プロジェクトルート>.tmp/discovery.json` を読み、`documents` 配列から全ドキュメントの `path` のリストを抽出します。
    -   次に、抽出したパスのリストを `read_file` ツールの `--path` 引数にすべて渡して実行します。（例: `--path path1.md --path path2.md ...`）
    -   ツールは、各ファイルの内容を含むJSONを返します。

2.  **エンリッチ情報の生成:**
    -   `read_file` から返された全ドキュメントの内容を基に、各ドキュメントの `title` と `summary` をあなたの推論能力で生成します。
    -   結果を、以下の形式を持つオブジェクトの**配列**としてメモリ上に構築します。AIの仕事は、この配列を生成することだけです。
        ```json
        [
          {"path": "path/to/doc1.md", "title": "...", "summary": "..."},
          {"path": "path/to/doc2.md", "title": "...", "summary": "..."}
        ]
        ```

3.  **一括更新の実行:**
    -   `enrich_discovery` ツールを呼び出します。
    -   `--discovery-path` 引数に、更新対象である `<プロジェクトルート>/.tmp/discovery.json` のパスを指定します。
    -   `--updates` 引数に、ステップ2で生成したJSON配列を**文字列として**渡します。
    -   このツールが、`<プロジェクトルート>.tmp/discovery.json` への安全かつ効率的な書き込みを実行します。

### 3. メタデータ登録と最終配置
**注意:** 最初に、`discovery.json`を読み込んでください。
1.  **ナレッジベース全体のメタデータ生成:**
    -   `read_file` ツールを使い、エンリッチ済みの `<プロジェクトルート>.tmp/discovery.json` の内容を読み込みます。
    -   `documents` 配列内のすべてのドキュメントの `summary` を連結し、それを基にナレッジベース全体を表す**単一の** `title` と `summary` をあなたの推論能力で生成します。
2.  **最終登録:**
    -   `entry_discovery` ツールを呼び出します。`--kb-root` に `{{kb_root}}` を、`--title` と `--summary` には今あなたが生成したものを、`--source-url` と `--src-type` にはワークフローの初期段階で与えられた情報を指定してください。
3.  **完成したファイルの移動:**
    -   `move_file` ツールを呼び出します。
    -   `--source` に `<プロジェクトルート>.tmp/discovery.json` を指定します。
    -   `--destination` に最終的な配置場所である `{{kb_root}}/cache/discovery.json` を指定します。

### 4. 完了報告
**注意:** 最初に、`discovery.json`を読み込んでください。
1.  **ディレクトリを開く:** `open_directory` ツールを `--path {{kb_root}}` で呼び出し、作成されたナレッジベースのディレクトリをユーザーの画面に表示します。
2.  **ユーザーへのメッセージ:** ツール実行後、以下のメッセージをユーザーに伝えてください。
    > ナレッジベースが作成されました。表示されたウィンドウ内でターミナルを開き、`/ask` コマンドで質問を開始してください。