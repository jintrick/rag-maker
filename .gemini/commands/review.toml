description = "RAGMaker実装のガイドライン準拠レビューを行う（/review <issue番号>）"
prompt = """
Issue {{args}} の実装について、プロジェクトのアーキテクチャおよび設計原則への準拠を、厳格かつ批判的にレビューせよ。

## 0. レビュー準備（必須アクション）
以下の情報を収集し、実装内容を把握せよ。
1. `git status` および `git diff` : 変更されたファイルと内容の確認。ただしコマンドの連結には`&&`ではなくセミコロンを使うこと。
2. `pytest` : テストの実行結果と網羅性の確認。
3. `glob` および `read_file` : 変更されたツール（`src/ragmaker/tools/`）、ユーティリティ（`src/ragmaker/utils.py`）、および `discovery.json` の内容確認。

## 必須チェック項目 (Critical Checklist)
各項目について、具体的なファイル名と実装箇所を特定した上で評価せよ。

### 1. アーキテクチャ原則 (Critical)
- [ ] **マスターツールカタログの更新**
    - 新機能やツールの追加・変更に伴い、プロジェクトルートの `discovery.json` が正しく更新されているか。
    - `args` や `handles` の定義が、実際の実装と整合しているか。
- [ ] **ドキュメントカタログの純粋性**
    - 各ツールがナレッジベース内の `discovery.json` を操作する際、ツール定義などの余計な情報を混入させていないか。
- [ ] **関心の分離**
    - 入出力処理（`io_utils.py`）、共通ロジック（`utils.py`）、各ツールの個別ロジックが適切に分離されているか。

### 2. ツールの実装規約
- [ ] **冪等性と安全性**
    - ファイル操作やカタログ更新が、再試行可能な（途中で失敗しても不整合が起きにくい）実装になっているか。
- [ ] **エラーハンドリング**
    - 外部コマンド（readability-cli等）の失敗やネットワークエラーが適切にトラップされ、ユーザーに分かりやすいメッセージを返しているか。
- [ ] **パスの正規化**
    - OS（Windows/Linux/macOS）に依存しないパス処理が行われているか。

### 3. コード品質とスタイル
- [ ] **常体（だ・である）の遵守**
    - ドキュメントやログ出力、コメントがプロジェクトのトーンに合っているか。
- [ ] **DRY原則**
    - 他のツールと重複する処理が `utils.py` 等に共通化されているか。

### 4. テストと検証
- [ ] **pytest による検証**
    - `test/` 配下に適切なテストコードが追加・更新され、正常系および異常系が網羅されているか。
    - モック（MagicMock等）が必要な箇所で適切に使用されているか。

## レビュー出力形式
**判定結果:** [合格 / 不合格 / 条件付き合格]
**発見された問題点:**
1. (ファイル名:行数) [違反項目] 問題の詳細
**修正提案:**
- 具体的なコード修正・設計変更案
**結論:**
- 完了（Merge/Commit）してよいか、再修正が必要か。
"""