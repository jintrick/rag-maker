description = "RAGMaker実装のガイドライン準拠レビューを「攻撃的解析」により行う（/review <issue番号>）"
prompt = """
Issue {{args}} の実装について、プロジェクトのアーキテクチャおよび設計原則への準拠を、極めて厳格かつ批判的にレビューせよ。
「問題なし」と結論づける前に、必ず「あえて失敗させるシナリオ」を想定し、バグを捏造してでも疑え。

## 0. レビュー準備（必須アクション）
手順を一つずつ確実に実行せよ。物理的な情報の取得なしに評価を下すことは「欺瞞」と見なす。
1. `git pull` : 最新の実装をローカルに確保せよ。
2. `git status` および `git diff` : 変更されたファイルと内容を確認せよ。
3. `gh pr view <PR番号> --comments` : 全体の要約を確認せよ。
4. `gh api repos/:owner/:repo/pulls/<PR番号>/comments --jq '.[].body'` : gca 等による詳細な行コメントを漏らさず取得し、反映せよ。
5. `pytest` : テストの実行結果と網羅性を確認せよ。
6. `glob` および `read_file` : 変更されたツール（`src/ragmaker/tools/`）、ユーティリティ（`src/ragmaker/utils.py`）、および `discovery.json` の内容を精査せよ。

## 必須チェック項目 (Adversarial Checklist)
各項目について、具体的なファイル名と実装箇所を特定した上で評価せよ。

### 1. 破壊的退行の検証 (Critical)
- [ ] **スタンドアロン実行の死守**: 
    - `ImportError` ブロックを精査せよ。新規導入されたシンボルのフォールバックが漏れていないか？ 
    - パッケージ未インストールの環境でクラッシュする「爆弾」が埋まっていないか徹底的に疑え。
- [ ] **責務の完遂**: 
    - 「安全」を口実に、本来そのツールが果たすべき破壊（初期化、古いデータの削除、上書き）まで放棄していないか？ 
    - ゴミを残すことを「安全」と呼ぶ実装者の怠慢を許すな。

### 2. アーキテクチャ原則と設計の美学
- [ ] **マスターツールカタログの更新**: 
    - `discovery.json` の定義（name, args, required）が、実際の実装と 1bit の狂いもなく整合しているか。
- [ ] **インポートの純粋性 (PEP 8)**: 
    - 関数内インポートなどの場当たり的な記述がないか。あれば「設計汚染」として糾弾せよ。
- [ ] **リソースの最適化**: 
    - 一時ディレクトリの不必要なネストや、重複したファイルコピーを「資源の浪費」として指摘せよ。

### 3. ツールの実装規約と堅牢性
- [ ] **型衝突への耐性**: 
    - コピー先に同名の「ファイル」が存在する場合など、OSレベルでの衝突を `shutil` がどう扱うか、最悪のケースを想定せよ。
- [ ] **例外チェーンの維持**: 
    - `raise ... from` を使用し、根本原因を隠蔽していないか。

### 4. テストのリアリティ
- [ ] **モックの妥当性**: 
    - `Exception` などの汎用例外で誤魔化していないか。実際のライブラリ（GitPython 等）が投げる具体的な例外クラスを使え。
- [ ] **テスト環境の隔離**: 
    - テスト実行によってリポジトリルートが汚染されていないか。`tempfile` による隔離を徹底せよ。

## レビュー出力形式
**判定結果:** [合格 / 不合格 / 条件付き合格]
**発見された問題点:**
1. (ファイル名:行数) [違反項目] 問題の詳細と「最悪のシナリオ」
**修正提案:**
- 具体的なコード修正・設計変更案
**結論:**
- 完了（Merge/Commit）を承認するか、再修正を命じるか。
"""
